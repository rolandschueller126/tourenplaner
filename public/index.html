<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tourenplaner â€“ Dein KI Agent fÃ¼r feine Touren | by rosch-lab</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.9.3/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.9.3/mapbox-gl.js"></script>
<style>
  :root {
    --bg: #faf8f4;
    --bg-tile: #ffffff;
    --forest: #2c3e2d;
    --forest-light: #3d6b4f;
    --copper: #c8702a;
    --copper-light: #e8943e;
    --earth: #8b6f47;
    --sand: #d4c5a9;
    --sand-light: #e8dcc8;
    --warn: #e6a817;
    --danger: #c45c4a;
    --info: #5b8ab5;
    --text: #2a2a2a;
    --text-muted: #6b6b6b;
    --text-light: #999;
    --border: #e5e0d8;
    --radius: 12px;
    --radius-sm: 8px;
    --shadow: 0 2px 12px rgba(44,62,45,0.08);
    --shadow-hover: 0 4px 20px rgba(44,62,45,0.14);
    --font: 'DM Sans', sans-serif;
    --mono: 'JetBrains Mono', monospace;
    /* tag colors */
    --tag-tip: #f5e6c8;
    --tag-tip-text: #8b6f47;
    --tag-photo: #d4e4f5;
    --tag-photo-text: #3a6b9f;
    --tag-hidden: #e8d8f0;
    --tag-hidden-text: #7b5a9e;
    --tag-food: #fce4c8;
    --tag-food-text: #9a6a2a;
    --tag-nature: #d0e8d4;
    --tag-nature-text: #3d6b4f;
    --tag-warn: #fef3cd;
    --tag-warn-text: #856404;
    --tag-danger: #f8d7da;
    --tag-danger-text: #842029;
    --tag-fuel: #d1ecf1;
    --tag-fuel-text: #0c5460;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .header {
    background: var(--forest);
    color: white;
    padding: 16px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-left { display: flex; align-items: center; gap: 14px; }
  .logo {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--copper-light); }
  .vehicle-badge {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.2);
    padding: 5px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .header-right { display: flex; gap: 10px; }
  .btn-header {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    font-family: var(--font);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-header:hover { background: rgba(255,255,255,0.2); }

  /* â”€â”€ DAY PILLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .day-nav {
    display: flex;
    gap: 6px;
    padding: 14px 28px;
    background: white;
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
  }
  .day-pill {
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    white-space: nowrap;
    border: 1.5px solid var(--border);
    background: white;
    color: var(--text-muted);
    transition: all 0.2s;
  }
  .day-pill:hover { border-color: var(--copper); color: var(--copper); }
  .day-pill.active {
    background: var(--forest);
    color: white;
    border-color: var(--forest);
  }
  .day-pill.total {
    border-color: var(--copper);
    color: var(--copper);
    font-weight: 600;
  }
  .day-pill.total.active {
    background: var(--copper);
    color: white;
    border-color: var(--copper);
  }

  /* â”€â”€ TILES GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tiles {
    display: flex;
    padding: 14px 28px 28px;
    height: calc(100vh - 120px);
    min-height: 600px;
    gap: 0;
  }
  .tiles-left {
    display: flex;
    flex-direction: column;
    min-width: 280px;
    overflow: hidden;
  }
  .tiles-right {
    display: flex;
    flex-direction: column;
    min-width: 220px;
    overflow: hidden;
  }

  /* Drag handles */
  .drag-h {
    width: 8px;
    cursor: col-resize;
    background: transparent;
    position: relative;
    flex-shrink: 0;
    z-index: 10;
  }
  .drag-h:hover, .drag-h.active { background: var(--copper); opacity: 0.25; border-radius: 4px; }
  .drag-h::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 2px; height: 32px;
    background: var(--sand); border-radius: 2px;
  }
  .drag-h:hover::after, .drag-h.active::after { background: var(--copper); }

  .drag-v {
    height: 8px;
    cursor: row-resize;
    background: transparent;
    position: relative;
    flex-shrink: 0;
    z-index: 10;
  }
  .drag-v:hover, .drag-v.active { background: var(--copper); opacity: 0.25; border-radius: 4px; }
  .drag-v::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 32px; height: 2px;
    background: var(--sand); border-radius: 2px;
  }
  .drag-v:hover::after, .drag-v.active::after { background: var(--copper); }

  .tile {
    background: var(--bg-tile);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.2s;
  }
  .tile:hover { box-shadow: var(--shadow-hover); }

  /* Tile A: Content/POIs */
  .tile-a { flex: 1; overflow-y: auto; }
  /* Tile B: Map */
  .tile-b { flex: 1; min-height: 120px; }
  /* Tile C: Route Hints */
  .tile-c { flex: 1; overflow-y: auto; min-height: 120px; }

  .tile-header {
    padding: 14px 18px;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
    font-weight: 600;
    color: var(--forest);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    background: var(--bg);
  }
  .tile-header .subtitle {
    font-size: 12px;
    font-weight: 400;
    color: var(--text-muted);
  }
  .tile-body { padding: 16px 18px; flex: 1; overflow-y: auto; }

  /* â”€â”€ STOP CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stop-card {
    padding: 16px 0;
    border-bottom: 1px solid var(--border);
  }
  .stop-card:last-child { border-bottom: none; }
  .stop-num {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 26px;
    height: 26px;
    background: var(--forest);
    color: white;
    border-radius: 50%;
    font-size: 12px;
    font-weight: 600;
    margin-right: 10px;
    flex-shrink: 0;
  }
  .stop-title {
    font-size: 15px;
    font-weight: 600;
    display: flex;
    align-items: center;
  }
  .stop-meta {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
    margin-left: 36px;
    font-family: var(--mono);
  }
  .stop-desc {
    margin-top: 8px;
    margin-left: 36px;
    font-size: 13.5px;
    line-height: 1.55;
    color: var(--text);
  }

  /* â”€â”€ TIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tips-list {
    margin-top: 10px;
    margin-left: 36px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .tip {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    font-size: 13px;
    line-height: 1.5;
    padding: 10px 12px;
    background: var(--bg);
    border-radius: var(--radius-sm);
    border-left: 3px solid transparent;
  }
  .tip.tip-insider { border-left-color: var(--copper); }
  .tip.tip-hidden { border-left-color: #7b5a9e; }
  .tip.tip-photo { border-left-color: var(--info); }
  .tip.tip-food { border-left-color: var(--copper-light); }
  .tip.tip-nature { border-left-color: var(--forest-light); }

  .tip-tag {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 2px 8px;
    border-radius: 10px;
    white-space: nowrap;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .tip-tag.tag-tip { background: var(--tag-tip); color: var(--tag-tip-text); }
  .tip-tag.tag-photo { background: var(--tag-photo); color: var(--tag-photo-text); }
  .tip-tag.tag-hidden { background: var(--tag-hidden); color: var(--tag-hidden-text); }
  .tip-tag.tag-food { background: var(--tag-food); color: var(--tag-food-text); }
  .tip-tag.tag-nature { background: var(--tag-nature); color: var(--tag-nature-text); }

  .tip-content { flex: 1; }
  .tip-text { margin-bottom: 4px; }

  /* â”€â”€ WEB LINKS (NEU!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tip-links {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 5px;
  }
  .tip-link {
    font-size: 10.5px;
    font-weight: 500;
    padding: 2px 9px;
    border-radius: 10px;
    text-decoration: none;
    border: 1px solid var(--border);
    color: var(--text-muted);
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }
  .tip-link:hover {
    border-color: var(--copper);
    color: var(--copper);
    background: rgba(200,112,42,0.05);
  }
  .tip-link .link-icon { font-size: 11px; }

  /* â”€â”€ ACCOMMODATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .accom-card {
    margin-top: 12px;
    margin-left: 36px;
    padding: 12px 14px;
    background: linear-gradient(135deg, #f0ebe3, #faf8f4);
    border-radius: var(--radius-sm);
    border: 1px solid var(--sand);
  }
  .accom-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--earth);
    margin-bottom: 4px;
  }
  .accom-meta {
    font-size: 12px;
    color: var(--text-muted);
    font-family: var(--mono);
  }
  .accom-tips {
    margin-top: 8px;
    font-size: 12.5px;
    color: var(--text);
    line-height: 1.5;
  }

  /* â”€â”€ BUDGET BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .budget-bar {
    display: flex;
    gap: 16px;
    padding: 12px 18px;
    border-top: 1px solid var(--border);
    background: var(--bg);
    flex-shrink: 0;
    font-size: 13px;
  }
  .budget-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .budget-icon { font-size: 15px; }
  .budget-label { color: var(--text-muted); font-size: 12px; }
  .budget-value { font-weight: 600; font-family: var(--mono); font-size: 13px; }
  .budget-total {
    margin-left: auto;
    font-weight: 700;
    color: var(--forest);
    font-size: 15px;
  }

  /* â”€â”€ MAP TILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .map-container {
    flex: 1;
    position: relative;
    overflow: hidden;
  }
  .map-canvas {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0; left: 0;
  }
  .mapboxgl-canvas { outline: none; }
  .map-marker {
    cursor: pointer;
    transition: transform 0.2s;
  }
  .map-marker:hover { transform: scale(1.2); }
  .map-marker-label {
    font-family: 'DM Sans', sans-serif;
    font-size: 10px;
    font-weight: 600;
    fill: var(--forest);
  }
  .map-legend {
    position: absolute;
    bottom: 8px;
    left: 8px;
    background: rgba(255,255,255,0.92);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.12);
  }
  .map-legend-item { display: flex; align-items: center; gap: 6px; }
  .map-legend-dot {
    width: 8px; height: 8px; border-radius: 50%;
  }

  /* â”€â”€ ROUTE HINTS (Streckenhinweise) â”€â”€ */
  .hint {
    display: flex;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
    line-height: 1.45;
    align-items: flex-start;
  }
  .hint:last-child { border-bottom: none; }
  .hint-icon {
    font-size: 18px;
    flex-shrink: 0;
    width: 28px;
    text-align: center;
    margin-top: 1px;
  }
  .hint-content { flex: 1; }
  .hint-title { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
  .hint-text { color: var(--text-muted); font-size: 12.5px; }
  .hint-tag {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 10px;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .hint-tag.warn { background: var(--tag-warn); color: var(--tag-warn-text); }
  .hint-tag.danger { background: var(--tag-danger); color: var(--tag-danger-text); }
  .hint-tag.fuel { background: var(--tag-fuel); color: var(--tag-fuel-text); }
  .hint-tag.info { background: var(--tag-photo); color: var(--tag-photo-text); }

  /* Height Profile Mini Chart */
  .height-profile {
    margin-top: 10px;
    padding: 10px 0;
    border-top: 1px solid var(--border);
  }
  .height-profile-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }
  .height-bars {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 50px;
  }
  .height-bar {
    flex: 1;
    border-radius: 3px 3px 0 0;
    min-height: 4px;
    position: relative;
    transition: opacity 0.2s;
  }
  .height-bar:hover { opacity: 0.8; }
  .height-bar.low { background: var(--forest-light); }
  .height-bar.mid { background: var(--warn); }
  .height-bar.high { background: var(--danger); }
  .height-labels {
    display: flex;
    gap: 3px;
    margin-top: 3px;
  }
  .height-label {
    flex: 1;
    font-size: 9px;
    font-family: var(--mono);
    color: var(--text-light);
    text-align: center;
  }

  /* Country flags bar */
  .countries-bar {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }
  .country-chip {
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: var(--bg);
    border-radius: 14px;
    border: 1px solid var(--border);
  }
  .country-chip .flag { font-size: 14px; }
  .country-chip .maut {
    font-size: 10px;
    color: var(--text-muted);
    font-family: var(--mono);
  }

  /* â”€â”€ TOTAL VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .total-view { display: none; }
  .total-view.active { display: flex; flex-direction: column; }

  .total-grid {
    display: flex;
    padding: 14px 28px 28px;
    flex: 1;
    min-height: 0;
    gap: 0;
  }
  .total-left {
    display: flex;
    flex-direction: column;
    min-width: 280px;
    overflow: hidden;
  }
  .total-right {
    display: flex;
    flex-direction: column;
    min-width: 220px;
    overflow: hidden;
    gap: 0;
  }
  .total-grid .tile { min-height: 0; flex: 1; }

  .stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }
  .stat-card {
    padding: 14px;
    background: var(--bg);
    border-radius: var(--radius-sm);
    text-align: center;
  }
  .stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--forest);
    font-family: var(--mono);
  }
  .stat-label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }

  .highlight-item {
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }
  .highlight-item:last-child { border-bottom: none; }
  .highlight-day {
    font-size: 11px;
    color: var(--copper);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }
  .highlight-text { margin-top: 3px; line-height: 1.45; }

  .checklist { list-style: none; }
  .checklist li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
    display: flex;
    gap: 8px;
    align-items: flex-start;
  }
  .checklist li:last-child { border-bottom: none; }
  .check-icon { flex-shrink: 0; margin-top: 1px; }

  /* â”€â”€ WEATHER STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .weather-strip {
    display: flex;
    gap: 6px;
    padding: 10px 18px;
    background: var(--bg);
    border-top: 1px solid var(--border);
    flex-shrink: 0;
    overflow-x: auto;
  }
  .weather-chip {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 4px 10px;
    font-size: 11px;
    background: white;
    border-radius: 8px;
    border: 1px solid var(--border);
    min-width: 56px;
  }
  .weather-chip .temp {
    font-weight: 600;
    font-family: var(--mono);
    font-size: 13px;
  }
  .weather-chip .time { color: var(--text-light); font-size: 10px; }

  /* â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tile-body::-webkit-scrollbar { width: 5px; }
  .tile-body::-webkit-scrollbar-track { background: transparent; }
  .tile-body::-webkit-scrollbar-thumb { background: var(--sand); border-radius: 10px; }
  .tile-body::-webkit-scrollbar-thumb:hover { background: var(--earth); }

  /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 1100px) {
    .tiles {
      flex-direction: column;
      height: auto;
    }
    .tiles-left, .tiles-right { width: 100% !important; }
    .tiles-left { max-height: 500px; }
    .tile-b { min-height: 250px; }
    .tile-c { max-height: 350px; }
    .drag-h { display: none; }
    .total-grid { flex-direction: column; }
    .total-left, .total-right { width: 100% !important; }
    #dragH2 { display: none; }
  }

  /* Fade-in animation */
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .tile { animation: fadeSlideIn 0.3s ease-out; }
  /* â”€â”€ TOUR PLANNER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: var(--bg);
    border-radius: 16px;
    width: 520px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border: 1px solid var(--border);
  }
  .modal-header {
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-header h2 {
    font-size: 18px;
    font-weight: 700;
    color: var(--forest);
    margin: 0;
  }
  .modal-close {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: var(--text-muted);
    padding: 4px 8px;
    border-radius: 6px;
  }
  .modal-close:hover { background: var(--sand); }
  .modal-body { padding: 24px; }
  .form-group {
    margin-bottom: 18px;
  }
  .form-group label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 6px;
  }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-family: var(--body);
    font-size: 14px;
    background: var(--bg-tile);
    color: var(--text);
    box-sizing: border-box;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none;
    border-color: var(--copper);
    box-shadow: 0 0 0 3px rgba(200,112,42,0.15);
  }
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .vehicle-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .vehicle-option:hover { border-color: var(--copper); background: rgba(200,112,42,0.05); }
  .vehicle-option.selected { border-color: var(--copper); background: rgba(200,112,42,0.1); }
  .vehicle-option input[type="radio"] { display: none; }
  .vehicle-icon { font-size: 24px; }
  .vehicle-label { font-size: 13px; font-weight: 600; }
  .vehicle-desc { font-size: 11px; color: var(--text-muted); }

  .btn-generate {
    width: 100%;
    padding: 14px;
    background: var(--forest);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    font-family: var(--body);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    margin-top: 8px;
  }
  .btn-generate:hover { background: #2c5a3d; transform: translateY(-1px); }
  .btn-generate:disabled {
    background: var(--sand);
    color: var(--text-muted);
    cursor: not-allowed;
    transform: none;
  }

  /* Loading spinner */
  .spinner {
    width: 20px; height: 20px;
    border: 3px solid rgba(255,255,255,0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(250,248,244,0.92);
    z-index: 2000;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
  }
  .loading-overlay.active { display: flex; }
  .loading-text {
    font-size: 16px;
    font-weight: 600;
    color: var(--forest);
  }
  .loading-sub {
    font-size: 13px;
    color: var(--text-muted);
    max-width: 300px;
    text-align: center;
    line-height: 1.5;
  }
  .loading-spinner {
    width: 48px; height: 48px;
    border: 4px solid var(--sand);
    border-top: 4px solid var(--copper);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  .tile-b { animation-delay: 0.05s; }
  .tile-c { animation-delay: 0.1s; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• LOADING OVERLAY â•â•â•â•â•â•â• -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">ğŸ—ºï¸ Deine Tour wird geplant...</div>
  <div class="loading-sub" id="loadingStatus">Claude analysiert die Route, sucht Insider-Tipps und plant deine Stopps.</div>
</div>

<!-- â•â•â•â•â•â•â• TOUR PLANNER MODAL â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="tourModal">
  <div class="modal">
    <div class="modal-header">
      <h2>âœï¸ Neue Tour planen</h2>
      <button class="modal-close" onclick="closeTourModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>ğŸŸ¢ Startort</label>
        <input type="text" id="tourStart" placeholder="z.B. MÃ¼nchen, Hamburg, Wien..." value="">
      </div>
      <div class="form-group">
        <label>ğŸ”´ Zielort</label>
        <input type="text" id="tourEnd" placeholder="z.B. Gardasee, Barcelona, Dubrovnik..." value="">
      </div>

      <div class="form-group">
        <label>ğŸš— Fahrzeug</label>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <div class="vehicle-option selected" onclick="selectVehicle(this, 'vespa')">
            <input type="radio" name="vehicle" value="vespa" checked>
            <div class="vehicle-icon">ğŸ›µ</div>
            <div><div class="vehicle-label">Vespa 125cc</div><div class="vehicle-desc">max 90 km/h Â· keine Autobahn</div></div>
          </div>
          <div class="vehicle-option" onclick="selectVehicle(this, 'wohnmobil')">
            <input type="radio" name="vehicle" value="wohnmobil">
            <div class="vehicle-icon">ğŸš</div>
            <div><div class="vehicle-label">Wohnmobil</div><div class="vehicle-desc">7.20m Â· 4.8t Â· StellplÃ¤tze</div></div>
          </div>
          <div class="vehicle-option" onclick="selectVehicle(this, 'auto')">
            <input type="radio" name="vehicle" value="auto">
            <div class="vehicle-icon">ğŸš—</div>
            <div><div class="vehicle-label">Auto</div><div class="vehicle-desc">Flexibel Â· alle StraÃŸen</div></div>
          </div>
          <div class="vehicle-option" onclick="selectVehicle(this, 'fahrrad')">
            <input type="radio" name="vehicle" value="fahrrad">
            <div class="vehicle-icon">ğŸš²</div>
            <div><div class="vehicle-label">Fahrrad / E-Bike</div><div class="vehicle-desc">Radwege Â· max 80km/Tag</div></div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>ğŸ“… Anzahl Tage</label>
          <select id="tourDays">
            <option value="2">2 Tage</option>
            <option value="3">3 Tage</option>
            <option value="4">4 Tage</option>
            <option value="5" selected>5 Tage</option>
            <option value="7">7 Tage</option>
            <option value="10">10 Tage</option>
          </select>
        </div>
        <div class="form-group">
          <label>âœ¨ Stimmung / Vibe</label>
          <select id="tourVibe">
            <option value="Entspannt mit Genuss â€“ viele Pausen, gutes Essen, keine Hetze">ğŸŒ¿ Entspannt & Genuss</option>
            <option value="Abenteuer â€“ PassstraÃŸen, Natur, Off-the-beaten-path">ğŸ”ï¸ Abenteuer</option>
            <option value="Kultur & Geschichte â€“ Museen, AltstÃ¤dte, Architektur">ğŸ›ï¸ Kultur & Geschichte</option>
            <option value="Sportlich â€“ maximale Kilometer, wenig Pausen, ambitioniert">âš¡ Sportlich</option>
            <option value="Fotografie â€“ beste Foto-Spots, Sonnenauf/untergÃ¤nge, Panoramen">ğŸ“¸ Fotografie</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>ğŸ’¬ ZusÃ¤tzliche WÃ¼nsche (optional)</label>
        <textarea id="tourNotes" rows="2" placeholder="z.B. Ich mag WeingÃ¼ter, vermeide GroÃŸstÃ¤dte, muss in Innsbruck Ã¼bernachten..."></textarea>
      </div>

      <button class="btn-generate" id="btnGenerate" onclick="generateTour()">
        ğŸš€ Tour generieren lassen
      </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
<div class="header">
  <div class="header-left">
    <div class="logo">Touren<span>planer</span></div>
    <div style="font-size:12px; opacity:0.6; margin-left:4px;">Dein KI Agent fÃ¼r feine Touren</div>
    <div class="vehicle-badge">ğŸ›µ Vespa 125cc Â· max 90 km/h Â· keine Autobahn</div>
  </div>
  <div class="header-right">
    <button class="btn-header" onclick="toggleView('form')">âœï¸ Neue Tour</button>
    <button class="btn-header">ğŸ“¥ GPX Export</button>
    <div style="font-size:11px; opacity:0.5; display:flex; align-items:center; gap:4px; margin-left:8px; border-left:1px solid rgba(255,255,255,0.15); padding-left:12px;">by rosch-lab</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• DAY PILLS â•â•â•â•â•â•â• -->
<div class="day-nav" id="dayNav">
  <div class="day-pill active" data-day="1" onclick="switchDay(1)">Tag 1 Â· MÃ¼nchenâ†’Innsbruck</div>
  <div class="day-pill" data-day="2" onclick="switchDay(2)">Tag 2 Â· Innsbruckâ†’Brenner</div>
  <div class="day-pill" data-day="3" onclick="switchDay(3)">Tag 3 Â· Brennerâ†’Bozen</div>
  <div class="day-pill" data-day="4" onclick="switchDay(4)">Tag 4 Â· Bozenâ†’Dolomiten</div>
  <div class="day-pill" data-day="5" onclick="switchDay(5)">Tag 5 Â· Dolomitenâ†’Gardasee</div>
  <div class="day-pill total" data-day="total" onclick="switchDay('total')">ğŸ“Š Total</div>
</div>

<!-- â•â•â•â•â•â•â• DAY VIEWS (Tiles) â•â•â•â•â•â•â• -->
<div class="tiles" id="tilesView">
  <!-- LEFT PANEL -->
  <div class="tiles-left" id="tilesLeft" style="flex: 2;">
    <!-- TILE A: POIs & Tipps -->
    <div class="tile tile-a" id="tileA">
      <div class="tile-header">
        <span>ğŸ“ Tagesetappe <span id="tileATitle">MÃ¼nchen â†’ Innsbruck</span></span>
        <span class="subtitle" id="tileAMeta">142 km Â· ~4h Â· 4 Stopps</span>
      </div>
      <div class="tile-body" id="tileABody">
        <!-- Content injected by JS -->
      </div>
      <div class="budget-bar" id="budgetBar">
        <div class="budget-item"><span class="budget-icon">â›½</span><span class="budget-label">Sprit</span><span class="budget-value" id="budgetFuel">â‚¬12</span></div>
        <div class="budget-item"><span class="budget-icon">ğŸ½ï¸</span><span class="budget-label">Essen</span><span class="budget-value" id="budgetFood">â‚¬35</span></div>
        <div class="budget-item"><span class="budget-icon">ğŸ›ï¸</span><span class="budget-label">Schlaf</span><span class="budget-value" id="budgetSleep">â‚¬65</span></div>
        <div class="budget-total" id="budgetTotal">Î£ â‚¬112</div>
      </div>
    </div>
  </div>

  <!-- VERTICAL DRAG HANDLE -->
  <div class="drag-h" id="dragH1"></div>

  <!-- RIGHT PANEL -->
  <div class="tiles-right" id="tilesRight" style="flex: 1;">
    <!-- TILE B: Karte -->
    <div class="tile tile-b" id="tileB" style="flex: 1;">
      <div class="tile-header">
        <span>ğŸ—ºï¸ Tagesroute</span>
        <span class="subtitle" id="tileBCountry">ğŸ‡©ğŸ‡ª â†’ ğŸ‡¦ğŸ‡¹</span>
      </div>
      <div class="map-container" id="mapContainer">
        <div class="map-canvas" id="mapCanvas"></div>
        <div class="map-legend">
          <div class="map-legend-item"><div class="map-legend-dot" style="background:var(--forest)"></div> Stopp</div>
          <div class="map-legend-item"><div class="map-legend-dot" style="background:var(--copper)"></div> Route (keine Autobahn)</div>
        </div>
      </div>
    </div>

    <!-- HORIZONTAL DRAG HANDLE -->
    <div class="drag-v" id="dragV1"></div>

    <!-- TILE C: Streckenhinweise -->
    <div class="tile tile-c" id="tileC" style="flex: 1;">
      <div class="tile-header">
        <span>âš ï¸ Streckenhinweise</span>
        <span class="subtitle">Vespa-spezifisch</span>
      </div>
      <div class="tile-body" id="tileCBody">
        <!-- Content injected by JS -->
      </div>
    </div>
  </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• TOTAL VIEW â•â•â•â•â•â•â• -->
<div class="total-view" id="totalView">
  <div class="total-grid">
    <!-- LEFT: Stats + Highlights -->
    <div class="total-left" id="totalLeft" style="flex: 1;">
      <div class="tile" style="flex:1; overflow-y: auto;">
        <div class="tile-header">
          <span>ğŸ“Š Tour-Zusammenfassung</span>
          <span class="subtitle">MÃ¼nchen â†’ Gardasee Â· 5 Tage</span>
        </div>
      <div class="tile-body">
        <div class="stat-grid">
          <div class="stat-card">
            <div class="stat-value">487</div>
            <div class="stat-label">Gesamt km</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">5</div>
            <div class="stat-label">Tage</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">â‚¬530</div>
            <div class="stat-label">Budget gesamt</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">20</div>
            <div class="stat-label">Stops</div>
          </div>
        </div>

        <h3 style="font-size:14px; color:var(--forest); margin-bottom:10px;">ğŸŒŸ Beste Highlights</h3>

        <div class="highlight-item">
          <div class="highlight-day">Tag 1 Â· MÃ¼nchen â†’ Innsbruck</div>
          <div class="highlight-text">Kochel am See â€“ Walchenseeblick von der alten KesselbergstraÃŸe. Einer der schÃ¶nsten Alpenseen, perfekt fÃ¼r eine erste Pause.</div>
        </div>
        <div class="highlight-item">
          <div class="highlight-day">Tag 2 Â· Innsbruck â†’ Brenner</div>
          <div class="highlight-text">Europa-BrÃ¼cke Aussichtspunkt â€“ Blick auf die hÃ¶chste BrÃ¼cke Europas (190m). Manche Ã¼bersehen den kleinen Parkplatz auf der alten StraÃŸe.</div>
        </div>
        <div class="highlight-item">
          <div class="highlight-day">Tag 3 Â· Brenner â†’ Bozen</div>
          <div class="highlight-text">Eisack-Radweg entlang der alten RÃ¶merstraÃŸe â€“ die Vespa teilt sich hier TeilstÃ¼cke mit Radfahrern. Langsam fahren, die Schlucht genieÃŸen.</div>
        </div>
        <div class="highlight-item">
          <div class="highlight-day">Tag 4 Â· Bozen â†’ Dolomiten</div>
          <div class="highlight-text">GrÃ¶dner Joch bei Sonnenaufgang â€“ wenn du frÃ¼h losfÃ¤hrst, hast du die StraÃŸe fast fÃ¼r dich allein. Unbezahlbar.</div>
        </div>
        <div class="highlight-item">
          <div class="highlight-day">Tag 5 Â· Dolomiten â†’ Gardasee</div>
          <div class="highlight-text">Ponale-StraÃŸe (alte MilitÃ¤rstraÃŸe) â€“ der spektakulÃ¤rste Weg an den Gardasee. Heute nur noch fÃ¼r FuÃŸgÃ¤nger/Radler, aber ein kurzer Abstecher zu FuÃŸ lohnt sich!</div>
        </div>

        <h3 style="font-size:14px; color:var(--forest); margin: 20px 0 10px;">ğŸ’ Packliste Vespa AlpenÃ¼berquerung</h3>
        <ul class="checklist">
          <li><span class="check-icon">â˜</span> Regenkombi (auch im Sommer â€“ Alpen!)</li>
          <li><span class="check-icon">â˜</span> Warme Schicht fÃ¼r Passfahrten (Fleece/Softshell)</li>
          <li><span class="check-icon">â˜</span> Erste-Hilfe-Set + Warndreieck + Warnweste (Pflicht AT/IT)</li>
          <li><span class="check-icon">â˜</span> Reservekanister 1L (rechtliche Lage vorher prÃ¼fen)</li>
          <li><span class="check-icon">â˜</span> Spanngurte fÃ¼r GepÃ¤ck</li>
          <li><span class="check-icon">â˜</span> Ladekabel + Powerbank</li>
          <li><span class="check-icon">â˜</span> Sonnenbrille + Sonnencreme (HÃ¶hensonne!)</li>
          <li><span class="check-icon">â˜</span> GrÃ¼ne Versicherungskarte + Zulassung</li>
          <li><span class="check-icon">â˜</span> Ã–AMTC/ADAC Auslandsschutzbrief</li>
          <li><span class="check-icon">â˜</span> Ersatz-ZÃ¼ndkerze + Werkzeug-Basics</li>
        </ul>

        <h3 style="font-size:14px; color:var(--forest); margin: 20px 0 10px;">ğŸ’° Budget-AufschlÃ¼sselung</h3>
        <table style="width:100%; font-size:13px; border-collapse:collapse;">
          <thead>
            <tr style="border-bottom:2px solid var(--border); text-align:left;">
              <th style="padding:8px 4px; font-weight:600;">Tag</th>
              <th style="padding:8px 4px; font-weight:600;">â›½ Sprit</th>
              <th style="padding:8px 4px; font-weight:600;">ğŸ½ï¸ Essen</th>
              <th style="padding:8px 4px; font-weight:600;">ğŸ›ï¸ Schlaf</th>
              <th style="padding:8px 4px; font-weight:600;">Î£</th>
            </tr>
          </thead>
          <tbody style="font-family:var(--mono); font-size:12px;">
            <tr style="border-bottom:1px solid var(--border);"><td style="padding:6px 4px;">Tag 1</td><td>â‚¬12</td><td>â‚¬35</td><td>â‚¬65</td><td style="font-weight:600;">â‚¬112</td></tr>
            <tr style="border-bottom:1px solid var(--border);"><td style="padding:6px 4px;">Tag 2</td><td>â‚¬10</td><td>â‚¬30</td><td>â‚¬70</td><td style="font-weight:600;">â‚¬110</td></tr>
            <tr style="border-bottom:1px solid var(--border);"><td style="padding:6px 4px;">Tag 3</td><td>â‚¬8</td><td>â‚¬35</td><td>â‚¬55</td><td style="font-weight:600;">â‚¬98</td></tr>
            <tr style="border-bottom:1px solid var(--border);"><td style="padding:6px 4px;">Tag 4</td><td>â‚¬14</td><td>â‚¬40</td><td>â‚¬60</td><td style="font-weight:600;">â‚¬114</td></tr>
            <tr style="border-bottom:1px solid var(--border);"><td style="padding:6px 4px;">Tag 5</td><td>â‚¬10</td><td>â‚¬38</td><td>â‚¬48</td><td style="font-weight:600;">â‚¬96</td></tr>
            <tr style="border-top:2px solid var(--forest);"><td style="padding:8px 4px; font-weight:700;">Gesamt</td><td style="font-weight:700;">â‚¬54</td><td style="font-weight:700;">â‚¬178</td><td style="font-weight:700;">â‚¬298</td><td style="font-weight:700; color:var(--forest);">â‚¬530</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    </div><!-- /total-left -->

    <!-- VERTICAL DRAG HANDLE -->
    <div class="drag-h" id="dragH2"></div>

    <!-- RIGHT: Map + Tips -->
    <div class="total-right" id="totalRight" style="flex: 1;">
    <!-- Gesamtkarte -->
    <div class="tile">
      <div class="tile-header">
        <span>ğŸ—ºï¸ Gesamtroute</span>
        <span class="subtitle">487 km Â· 5 Tage</span>
      </div>
      <div class="map-container">
        <div class="map-canvas" id="totalMapCanvas"></div>
        <div class="map-legend">
          <div class="map-legend-item"><div class="map-legend-dot" style="background:#c8702a"></div> Tag 1</div>
          <div class="map-legend-item"><div class="map-legend-dot" style="background:#3d6b4f"></div> Tag 2</div>
          <div class="map-legend-item"><div class="map-legend-dot" style="background:#5b8ab5"></div> Tag 3</div>
          <div class="map-legend-item"><div class="map-legend-dot" style="background:#7b5a9e"></div> Tag 4</div>
          <div class="map-legend-item"><div class="map-legend-dot" style="background:#c45c4a"></div> Tag 5</div>
        </div>
      </div>
    </div>

    <!-- HORIZONTAL DRAG HANDLE -->
    <div class="drag-v" id="dragV2"></div>

    <!-- Ãœbergreifende Tipps -->
    <div class="tile" style="overflow-y:auto;">
      <div class="tile-header">
        <span>ğŸ“‹ Ãœbergreifende Tipps</span>
        <span class="subtitle">Vespa AlpenÃ¼berquerung</span>
      </div>
      <div class="tile-body">
        <div class="hint">
          <div class="hint-icon">ğŸ›µ</div>
          <div class="hint-content">
            <div class="hint-title">Vespa-Check vor Abfahrt</div>
            <div class="hint-text">Ã–lstand, Reifendruck (kalt: 1.8 bar vorne / 2.2 hinten bei Beladung), Bremsen, Licht. Bei Alpentouren besonders wichtig: BremsbelÃ¤ge prÃ¼fen â€“ GefÃ¤lle frisst BelÃ¤ge.</div>
          </div>
        </div>
        <div class="hint">
          <div class="hint-icon">â›½</div>
          <div class="hint-content">
            <div class="hint-title">Tankstrategie Alpen</div>
            <div class="hint-text">Nie unter halb tanken im Gebirge. Zwischen Brenner und Bozen gibt's LÃ¼cken von 40+ km ohne Tankstelle. Sonntags haben viele kleine Tankstellen in Italien zu.</div>
          </div>
        </div>
        <div class="hint">
          <div class="hint-icon">ğŸŒ¡ï¸</div>
          <div class="hint-content">
            <div class="hint-title">Temperaturmanagement</div>
            <div class="hint-text">Zwiebelprinzip! Tal: 28Â°C, Pass: 12Â°C â€“ das sind 16Â° Unterschied innerhalb einer Stunde. Handschuhe immer griffbereit im Topcase.</div>
          </div>
        </div>
        <div class="hint">
          <div class="hint-icon">ğŸ“±</div>
          <div class="hint-content">
            <div class="hint-title">Navigation & Offline-Karten</div>
            <div class="hint-text">In TÃ¤lern und Tunneln oft kein Empfang. Offline-Karten vorher laden (Mapbox/Google Maps). Handyhalterung mit VibrationsdÃ¤mpfer empfohlen.</div>
          </div>
        </div>
        <div class="hint">
          <div class="hint-icon">ğŸ·ï¸</div>
          <div class="hint-content">
            <div class="hint-title">Maut & Vignette Zusammenfassung</div>
            <div class="hint-text">ğŸ‡©ğŸ‡ª Keine Maut fÃ¼r Vespa. ğŸ‡¦ğŸ‡¹ Keine Vignette fÃ¼r MotorrÃ¤der &lt;125cc â€“ aber Achtung: Brenner-Maut fÃ¤llt an (Sondermaut, ~â‚¬9). ğŸ‡®ğŸ‡¹ Keine Maut auf LandstraÃŸen, nur Autobahn (die wir meiden).</div>
          </div>
        </div>
      </div>
    </div>
    </div><!-- /total-right -->
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TourAgent v3.1 â€“ Demo Data & Logic
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const tourData = {
  1: {
    title: "MÃ¼nchen â†’ Innsbruck",
    meta: "142 km Â· ~4h Â· 4 Stopps",
    countries: "ğŸ‡©ğŸ‡ª â†’ ğŸ‡¦ğŸ‡¹",
    budget: { fuel: 12, food: 35, sleep: 65 },
    weather: [
      { time: "08:00", icon: "ğŸŒ¤ï¸", temp: "14Â°" },
      { time: "11:00", icon: "â˜€ï¸", temp: "22Â°" },
      { time: "14:00", icon: "â›…", temp: "20Â°" },
      { time: "17:00", icon: "ğŸŒ¤ï¸", temp: "18Â°" },
    ],
    stops: [
      {
        name: "Kochel am See",
        meta: "52 km Â· 10:30 Uhr Â· 45 min Pause",
        desc: "Malerischer Alpensee am FuÃŸ der Berge. Hier beginnt das Alpen-Feeling â€“ perfekt fÃ¼r die erste Kaffeepause mit Seeblick.",
        tips: [
          { type: "tip", tag: "Insider", text: "Die alte KesselbergstraÃŸe (nicht die neue!) bietet einen atemberaubenden Blick auf den Walchensee. Links abbiegen vor dem Tunnel.", links: ["Google Maps:https://www.google.com/maps/search/KesselbergstraÃŸe+Kochel", "Wikipedia:https://de.wikipedia.org/wiki/KesselbergstraÃŸe"] },
          { type: "photo", tag: "Foto-Spot", text: "Am Nordufer des Kochelsees mit den Bergen im Hintergrund â€“ morgens spiegelt sich alles im Wasser.", links: ["Google:https://www.google.com/search?q=Kochelsee+Foto+Spot+Nordufer"] },
          { type: "food", tag: "Einkehr", text: "CafÃ© Herzogstand direkt am See. Apfelstrudel ist legendÃ¤r, Cappuccino mittelmÃ¤ÃŸig.", links: ["Google Maps:https://www.google.com/maps/search/CafÃ©+Herzogstand+Kochel", "Tripadvisor:https://www.tripadvisor.com/Search?q=CafÃ©+Herzogstand+Kochel"] },
        ]
      },
      {
        name: "Mittenwald",
        meta: "85 km Â· 12:30 Uhr Â· 60 min Mittagspause",
        desc: "Die 'Geigenbauerstadt' mit wunderschÃ¶nen LÃ¼ftlmalereien. Direkt an der Grenze zu Ã–sterreich, wo die Isar noch kristallklar ist.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Die Leutascher Geisterklamm (3 km westlich) â€“ Ã¼ber 400m lange StahlbrÃ¼cke Ã¼ber die Schlucht. SpektakulÃ¤r und fast leer um die Mittagszeit.", links: ["Google:https://www.google.com/search?q=Leutascher+Geisterklamm", "Wikipedia:https://de.wikipedia.org/wiki/Leutaschklamm"] },
          { type: "tip", tag: "Insider", text: "In der ObermarktstraÃŸe stehen die schÃ¶nsten bemalten HÃ¤user. Nr. 23 hat ein fast 300 Jahre altes Fresko.", links: ["Google Maps:https://www.google.com/maps/search/ObermarktstraÃŸe+Mittenwald"] },
          { type: "food", tag: "Einkehr", text: "Gasthof Stern â€“ bodenstÃ¤ndig bayerisch. Die Schweinshaxn ist riesig, lieber zu zweit bestellen.", links: ["Google Maps:https://www.google.com/maps/search/Gasthof+Stern+Mittenwald", "Tripadvisor:https://www.tripadvisor.com/Search?q=Gasthof+Stern+Mittenwald"] },
        ]
      },
      {
        name: "Seefeld in Tirol",
        meta: "108 km Â· 14:30 Uhr Â· 30 min",
        desc: "Olympia-Ort auf einem sonnigen Hochplateau. Die Vespa braucht hier den ersten spÃ¼rbaren Anstieg â€“ aber noch harmlos.",
        tips: [
          { type: "photo", tag: "Foto-Spot", text: "Vom Seekirchl (kleine Kirche am Ortsrand) hat man bei klarer Sicht einen 360Â°-Panoramablick. Parkplatz direkt dahinter.", links: ["Google:https://www.google.com/search?q=Seekirchl+Seefeld+Panorama", "Google Maps:https://www.google.com/maps/search/Seekirchl+Seefeld"] },
          { type: "nature", tag: "Natur", text: "Wildsee (5 min zu FuÃŸ vom Zentrum) â€“ smaragdgrÃ¼n, je nach Licht fast unwirklich. Perfekt um die FÃ¼ÃŸe reinzuhÃ¤ngen.", links: ["Google:https://www.google.com/search?q=Wildsee+Seefeld+Tirol"] },
          { type: "tip", tag: "Insider", text: "Am Postamt gibt's einen Stempel fÃ¼r den Vespa-Reisepass (falls du einen fÃ¼hrst). Die Dame an der Kasse macht das gerne.", links: [] },
        ]
      },
      {
        name: "Innsbruck (Altstadt)",
        meta: "142 km Â· 16:30 Uhr Â· Ankunft",
        desc: "Goldenes Dachl, Nordkette, Inn-Ufer. Die letzte Etappe runter nach Innsbruck ist eine geniale Abfahrt mit Blick auf die Stadt.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Das Stiftskeller Biergarten hinter dem Dom â€“ hier sitzen fast nur Einheimische. Im Sommer drauÃŸen unter Kastanien.", links: ["Google Maps:https://www.google.com/maps/search/Stiftskeller+Innsbruck", "Tripadvisor:https://www.tripadvisor.com/Search?q=Stiftskeller+Innsbruck"] },
          { type: "photo", tag: "Foto-Spot", text: "Von der InnbrÃ¼cke Richtung Altstadt â€“ die bunten HÃ¤user mit Nordkette dahinter. DAS Innsbruck-Foto.", links: ["Google:https://www.google.com/search?q=InnbrÃ¼cke+Innsbruck+Foto"] },
          { type: "food", tag: "Einkehr", text: "Machete â€“ mexikanisch-alpin Fusion. Klingt schrÃ¤g, ist groÃŸartig. Burritos mit Tiroler Speck.", links: ["Google Maps:https://www.google.com/maps/search/Machete+Innsbruck", "Tripadvisor:https://www.tripadvisor.com/Search?q=Machete+Innsbruck"] },
        ],
        accom: {
          name: "Nala Individuell Hotel",
          meta: "â˜…â˜…â˜…â˜… Â· ab â‚¬65/Nacht Â· Stadtmitte Â· Vespa-Parkplatz im Hof",
          tips: "Abends: Bergisel-Schanze zu FuÃŸ erreichbar (20 min), nachts beleuchtet. Morgens: FrÃ¼hstÃ¼ck im Hotel ist gut, aber CafÃ© Central hat die besseren Croissants."
        }
      }
    ],
    hints: [
      { icon: "â›½", title: "Tankstopp empfohlen: Kochel", text: "NÃ¤chste gÃ¼nstige Tankstelle erst wieder in Mittenwald (33 km). Im Gebirge steigt der Verbrauch um ~30%.", tag: "fuel" },
      { icon: "â›°ï¸", title: "Steigung: Kesselberg (850m â†’ 800m)", text: "Erster Alpenpass der Tour â€“ aber harmlos fÃ¼r die Vespa. Im 2. Gang bleiben, nicht Ã¼berdrehen. Achtung: Radfahrer auf der Strecke!", tag: "warn" },
      { icon: "ğŸ·ï¸", title: "Grenze DEâ†’AT bei Scharnitz", text: "Keine Grenzkontrolle (Schengen), aber Ã–sterreich-Vignette beachten: Vespa <125cc ist BEFREIT! Keine Vignette nÃ¶tig.", tag: "info" },
      { icon: "ğŸŒ¡ï¸", title: "Temperatursturz Seefeldâ†’Innsbruck", text: "Plateau Seefeld (1200m): ~16Â°C. Abfahrt Innsbruck (570m): ~22Â°C. Jacke auf dem Plateau, runter wird's warm.", tag: "warn" },
    ],
    heightProfile: [
      { label: "MUC", height: 520, max: 2200 },
      { label: "Starn", height: 590, max: 2200 },
      { label: "Kochel", height: 600, max: 2200 },
      { label: "Kessel", height: 858, max: 2200 },
      { label: "Mittw", height: 920, max: 2200 },
      { label: "Schar", height: 960, max: 2200 },
      { label: "Seef", height: 1180, max: 2200 },
      { label: "IBK", height: 574, max: 2200 },
    ],
    countryInfo: [
      { flag: "ğŸ‡©ğŸ‡ª", name: "DE", maut: "frei" },
      { flag: "ğŸ‡¦ğŸ‡¹", name: "AT", maut: "frei*" },
    ],
    // Map coordinates (simplified for SVG simulation)
    mapStops: [
      { name: "MÃ¼nchen", lng: 11.576, lat: 48.137 },
      { name: "Kochel", lng: 11.369, lat: 47.659 },
      { name: "Mittenwald", lng: 11.264, lat: 47.442 },
      { name: "Seefeld", lng: 11.188, lat: 47.330 },
      { name: "Innsbruck", lng: 11.394, lat: 47.269 },
    ]
  },
  2: {
    title: "Innsbruck â†’ Brenner",
    meta: "68 km Â· ~2.5h Â· 4 Stopps",
    countries: "ğŸ‡¦ğŸ‡¹ â†’ ğŸ‡¦ğŸ‡¹/ğŸ‡®ğŸ‡¹",
    budget: { fuel: 10, food: 30, sleep: 70 },
    weather: [
      { time: "08:00", icon: "ğŸŒ¤ï¸", temp: "12Â°" },
      { time: "11:00", icon: "â˜€ï¸", temp: "19Â°" },
      { time: "14:00", icon: "â˜€ï¸", temp: "17Â°" },
      { time: "17:00", icon: "â›…", temp: "14Â°" },
    ],
    stops: [
      {
        name: "Bergisel & Patscherkofel PanoramastraÃŸe",
        meta: "8 km Â· 09:00 Uhr Â· 45 min",
        desc: "Start mit dem Stadtpanorama Ã¼ber Innsbruck. Die PanoramastraÃŸe rauf zum Patscherkofel-Parkplatz gibt einen Vorgeschmack auf die AlpenpÃ¤sse.",
        tips: [
          { type: "photo", tag: "Foto-Spot", text: "Bergisel-Schanze: Aussichtsplattform oben (â‚¬9 Eintritt). Alternativ: kostenlos von der StraÃŸe daneben fast genauso guter Blick.", links: ["Google Maps:https://www.google.com/maps/search/Bergisel+Schanze+Innsbruck", "Wikipedia:https://de.wikipedia.org/wiki/Bergiselschanze"] },
          { type: "tip", tag: "Insider", text: "Tankstelle am FuÃŸ des Bergisel (OMV): letzte gÃ¼nstige Tankstelle vor dem Brenner. In AT ca. â‚¬0.10/L gÃ¼nstiger als IT.", links: ["Google Maps:https://www.google.com/maps/search/OMV+Tankstelle+Bergisel+Innsbruck"] },
          { type: "nature", tag: "Natur", text: "Die alte RÃ¶merstraÃŸe (Via Raetia) fÃ¼hrt als Wanderweg parallel zur EuropabrÃ¼cke. Man sieht die BrÃ¼cke von unten â€“ beeindruckend.", links: ["Google:https://www.google.com/search?q=Via+Raetia+Innsbruck+Wanderweg"] },
        ]
      },
      {
        name: "Matrei am Brenner",
        meta: "28 km Â· 10:30 Uhr Â· 30 min",
        desc: "Letzter grÃ¶ÃŸerer Ort vor dem Pass. Die alte BrennerstraÃŸe beginnt hier â€“ schmaler, steiler, aber herrlich ruhig.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Maria Waldrast Kloster (Abstecher 6 km): hÃ¶chstgelegenes Kloster Tirols. Die Stille dort oben ist fast surreal. Kleine Gaststube im Kloster.", links: ["Google:https://www.google.com/search?q=Maria+Waldrast+Kloster", "Wikipedia:https://de.wikipedia.org/wiki/Kloster_Maria_Waldrast"] },
          { type: "food", tag: "Einkehr", text: "BÃ¤ckerei Ruetz in Matrei â€“ hol dir ein Vinschgauer BrÃ¶tl fÃ¼r die PasshÃ¶he. Frisch und gÃ¼nstig.", links: ["Google Maps:https://www.google.com/maps/search/BÃ¤ckerei+Ruetz+Matrei"] },
          { type: "tip", tag: "Insider", text: "Alte BrennerstraÃŸe (B182): Unbedingt diese nehmen statt der neuen StraÃŸe. Weniger Verkehr, mehr Kurven, tolle Aussicht.", links: ["Google:https://www.google.com/search?q=Alte+BrennerstraÃŸe+B182"] },
        ]
      },
      {
        name: "EuropabrÃ¼cke Aussichtspunkt",
        meta: "38 km Â· 11:30 Uhr Â· 20 min",
        desc: "Blick auf die hÃ¶chste BrÃ¼cke Europas (190m). Von der alten StraÃŸe hat man den besten Ausblick â€“ die Autofahrer auf der Autobahn sehen nichts davon.",
        tips: [
          { type: "photo", tag: "Foto-Spot", text: "Kleiner Parkplatz auf der alten StraÃŸe (vor der Schranke rechts). Von hier sieht man die BrÃ¼cke in voller Pracht.", links: ["Google Maps:https://www.google.com/maps/search/EuropabrÃ¼cke+Aussichtspunkt+Brenner"] },
          { type: "tip", tag: "Insider", text: "Die Maut fÃ¼r den Brenner (Sondermautabschnitt) gilt auch fÃ¼r die alte StraÃŸe: ~â‚¬9 fÃ¼r MotorrÃ¤der. Nicht erschrecken.", links: ["Google:https://www.google.com/search?q=Brenner+Maut+Motorrad+Preis"] },
          { type: "nature", tag: "Natur", text: "Von hier fÃ¼hrt ein kleiner Pfad 10 min runter zum Sillfluss. Im Sommer perfekt zum FÃ¼ÃŸe kÃ¼hlen.", links: [] },
        ]
      },
      {
        name: "Brennerpass (1.370m)",
        meta: "68 km Â· 13:00 Uhr Â· Ankunft",
        desc: "Der niedrigste AlpenhauptÃ¼bergang â€“ und trotzdem ein Meilenstein! Ab hier: Bella Italia.",
        tips: [
          { type: "tip", tag: "Insider", text: "Das Outlet-Center am Brenner hat Ã¼berraschend gÃ¼nstige italienische Marken. Wer Platz hat: Leder-Handschuhe fÃ¼r die Vespa gibt's ab â‚¬25.", links: ["Google Maps:https://www.google.com/maps/search/Outlet+Center+Brenner"] },
          { type: "photo", tag: "Foto-Spot", text: "Am Grenzstein 'ITALIA / Ã–STERREICH' â€“ das klassische Vespa-auf-dem-Pass Foto. Vespa daneben stellen, fertig.", links: ["Google:https://www.google.com/search?q=Brennerpass+Grenzstein+Foto"] },
          { type: "food", tag: "Einkehr", text: "Direkt am Pass: Brennero/Brenner Stube â€“ touristisch aber okay. Besser: 2 km weiter auf italienischer Seite, Trattoria al Lupo.", links: ["Google Maps:https://www.google.com/maps/search/Trattoria+al+Lupo+Brennero", "Tripadvisor:https://www.tripadvisor.com/Search?q=Trattoria+al+Lupo+Brennero"] },
        ],
        accom: {
          name: "Gasthof Alpenrose Brenner",
          meta: "â˜…â˜…â˜… Â· ab â‚¬70/Nacht Â· direkt am Pass Â· Garage fÃ¼r Vespa",
          tips: "Abends: Sonnenuntergang vom Pass â€“ die Berge werden rosa. Morgens: FrÃ¼h los (7:30) â€“ die Abfahrt nach Sterzing ist morgens am schÃ¶nsten."
        }
      }
    ],
    hints: [
      { icon: "â›½", title: "Letzter gÃ¼nstiger Sprit: Innsbruck", text: "In Ã–sterreich tanken! AT ist ~â‚¬0.10/L gÃ¼nstiger als Italien. OMV am Bergisel empfohlen.", tag: "fuel" },
      { icon: "â›°ï¸", title: "Brennerpass: 1.370m", text: "Steigung moderat (~6%), fÃ¼r Vespa gut machbar. Aber: 800 HÃ¶henmeter am StÃ¼ck, Vespa lÃ¤uft im letzten Drittel merklich langsamer. 2./3. Gang.", tag: "warn" },
      { icon: "ğŸ·ï¸", title: "Brenner-Maut: ~â‚¬9 Motorrad", text: "Auch alte BrennerstraÃŸe ist mautpflichtig. Bezahlung an Mautstation (Karte/Bar). Keine Vignette nÃ¶tig.", tag: "info" },
      { icon: "ğŸŒ¡ï¸", title: "Temperatur PasshÃ¶he", text: "Innsbruck (574m): ~20Â°C â†’ Brenner (1370m): ~12Â°C. 8 Grad Unterschied! Fleece/Windjacke bereithalten.", tag: "warn" },
    ],
    heightProfile: [
      { label: "IBK", height: 574, max: 2200 },
      { label: "Bergi", height: 740, max: 2200 },
      { label: "SchÃ¶n", height: 850, max: 2200 },
      { label: "Matrei", height: 990, max: 2200 },
      { label: "Stei", height: 1100, max: 2200 },
      { label: "Gries", height: 1200, max: 2200 },
      { label: "Grenz", height: 1320, max: 2200 },
      { label: "BREN", height: 1370, max: 2200 },
    ],
    countryInfo: [
      { flag: "ğŸ‡¦ğŸ‡¹", name: "AT", maut: "Brenner â‚¬9" },
      { flag: "ğŸ‡®ğŸ‡¹", name: "IT", maut: "frei (Landstr.)" },
    ],
    mapStops: [
      { name: "Innsbruck", lng: 11.394, lat: 47.269 },
      { name: "Bergisel", lng: 11.397, lat: 47.249 },
      { name: "Matrei", lng: 11.453, lat: 47.130 },
      { name: "EuropabrÃ¼cke", lng: 11.460, lat: 47.080 },
      { name: "Brenner", lng: 11.507, lat: 47.000 },
    ]
  },
  3: {
    title: "Brenner â†’ Bozen",
    meta: "82 km Â· ~3h Â· 4 Stopps",
    countries: "ğŸ‡®ğŸ‡¹",
    budget: { fuel: 8, food: 35, sleep: 55 },
    weather: [
      { time: "08:00", icon: "â›…", temp: "11Â°" },
      { time: "11:00", icon: "â˜€ï¸", temp: "23Â°" },
      { time: "14:00", icon: "â˜€ï¸", temp: "26Â°" },
      { time: "17:00", icon: "ğŸŒ¤ï¸", temp: "24Â°" },
    ],
    stops: [
      {
        name: "Sterzing / Vipiteno",
        meta: "14 km Â· 08:30 Uhr Â· 45 min",
        desc: "Mittelalterliche Altstadt mit dem berÃ¼hmten ZwÃ¶lferturm. Hier merkt man sofort: Du bist in SÃ¼dtirol. Deutsch und Italienisch mischen sich.",
        tips: [
          { type: "tip", tag: "Insider", text: "Die Milchbar Sterzing (ja, DIE Joghurt-Marke) hat einen Werksverkauf am Stadtrand. Frischer geht's nicht.", links: ["Google Maps:https://www.google.com/maps/search/Milchbar+Sterzing+Vipiteno", "Google:https://www.google.com/search?q=Sterzing+Joghurt+Werksverkauf"] },
          { type: "photo", tag: "Foto-Spot", text: "Die Neustadt-Gasse Richtung ZwÃ¶lferturm â€“ der symmetrische Blick auf den Turm ist ikonisch.", links: ["Google:https://www.google.com/search?q=ZwÃ¶lferturm+Sterzing+Foto"] },
          { type: "food", tag: "Einkehr", text: "CafÃ© Katzung: SÃ¼dtirols bester Apfelstrudel (heiÃŸ umstritten, aber hier wirklich gut). Dazu einen VerlÃ¤ngerten.", links: ["Google Maps:https://www.google.com/maps/search/CafÃ©+Katzung+Sterzing", "Tripadvisor:https://www.tripadvisor.com/Search?q=CafÃ©+Katzung+Sterzing"] },
        ]
      },
      {
        name: "Franzensfeste / Fortezza",
        meta: "32 km Â· 10:00 Uhr Â· 30 min",
        desc: "Riesige Festung aus dem 19. Jh., heute Ausstellungsort. Die Vespa-Strecke am Eisack entlang ist herrlich.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Die Festung hat oft kostenlose Kunstausstellungen. Lohnt sich fÃ¼r 20 min â€“ und die Toiletten sind sauber (unterwegs im Gebirge wertvoll!).", links: ["Google:https://www.google.com/search?q=Franzensfeste+Festung+Ausstellung", "Wikipedia:https://de.wikipedia.org/wiki/Franzensfeste"] },
          { type: "nature", tag: "Natur", text: "Am Stausee hinter der Festung kann man kurz die FÃ¼ÃŸe ins Wasser halten. Kristallklar.", links: ["Google Maps:https://www.google.com/maps/search/Stausee+Franzensfeste"] },
          { type: "tip", tag: "Insider", text: "Ab hier die SS12 nehmen (nicht die SchnellstraÃŸe). Die alte StraÃŸe folgt dem Eisack durch eine enge Schlucht â€“ spektakulÃ¤r.", links: ["Google:https://www.google.com/search?q=SS12+Eisacktal+alte+StraÃŸe"] },
        ]
      },
      {
        name: "Klausen / Chiusa",
        meta: "55 km Â· 11:30 Uhr Â· 60 min Mittagspause",
        desc: "Eines der schÃ¶nsten DÃ¶rfer Italiens! Enge Gassen, Kloster SÃ¤ben hoch oben. Hier fÃ¼hlst du dich wie im Mittelalter.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Kloster SÃ¤ben (30 min Aufstieg): wie ein kleines Mont-Saint-Michel. Die Vespa unten parken und hochlaufen â€“ die Aussicht belohnt alles.", links: ["Google:https://www.google.com/search?q=Kloster+SÃ¤ben+Klausen", "Wikipedia:https://de.wikipedia.org/wiki/Kloster_SÃ¤ben"] },
          { type: "food", tag: "Einkehr", text: "Gasthof Walther: Schlutzkrapfen (SÃ¼dtiroler Maultaschen) mit Butter und Salbei. Das Nationalgericht.", links: ["Google Maps:https://www.google.com/maps/search/Gasthof+Walther+Klausen", "Tripadvisor:https://www.tripadvisor.com/Search?q=Gasthof+Walther+Klausen"] },
          { type: "photo", tag: "Foto-Spot", text: "Von der BrÃ¼cke Ã¼ber den Eisack: Klausen mit Kloster SÃ¤ben oben drauf. Postkartenmotiv.", links: ["Google:https://www.google.com/search?q=Klausen+Eisack+BrÃ¼cke+Foto+SÃ¤ben"] },
        ]
      },
      {
        name: "Bozen / Bolzano",
        meta: "82 km Â· 14:30 Uhr Â· Ankunft",
        desc: "Hauptstadt SÃ¼dtirols â€“ Waltherplatz, Laubengasse, Ã–tzi im Museum. Die wÃ¤rmste Stadt der Tour, hier weht schon mediterranes Flair.",
        tips: [
          { type: "tip", tag: "Insider", text: "Die Laubengasse ist Europas lÃ¤ngste Einkaufsarkade. Nicht die GeschÃ¤fte, sondern die Deckenmalereien Ã¼ber den LÃ¤den sind sehenswert.", links: ["Google:https://www.google.com/search?q=Laubengasse+Bozen+Arkaden", "Wikipedia:https://de.wikipedia.org/wiki/Bozner_Lauben"] },
          { type: "hidden", tag: "Geheimtipp", text: "Castel Flavon (20 min Vespa bergauf): Restaurant in einer Ruine mit dem besten Blick Ã¼ber Bozen. Abends buchen!", links: ["Google Maps:https://www.google.com/maps/search/Castel+Flavon+Bozen", "Tripadvisor:https://www.tripadvisor.com/Search?q=Castel+Flavon+Bozen", "Booking:https://www.booking.com/searchresults.html?ss=Castel+Flavon+Bozen"] },
          { type: "food", tag: "Einkehr", text: "BatzenhÃ¤usl â€“ Ã¤ltestes Wirtshaus Bozens, seit 1404. Tris di Canederli (drei KnÃ¶del) mit SÃ¼dtiroler Wein.", links: ["Google Maps:https://www.google.com/maps/search/BatzenhÃ¤usl+Bozen", "Tripadvisor:https://www.tripadvisor.com/Search?q=BatzenhÃ¤usl+Bozen"] },
        ],
        accom: {
          name: "Kolpinghaus Bozen",
          meta: "â˜…â˜…â˜… Â· ab â‚¬55/Nacht Â· Altstadt Â· Vespa auf dem Piazza parken",
          tips: "Abends: Waltherplatz â€“ Aperol Spritz auf dem Platz ist Pflicht. Morgens: Obstmarkt ab 7 Uhr â€“ frisches Obst fÃ¼r die Dolomiten-Etappe mitnehmen."
        }
      }
    ],
    hints: [
      { icon: "â›½", title: "Nur Abfahrt â€“ wenig Verbrauch", text: "Vom Brenner (1370m) nach Bozen (262m) sind's Ã¼ber 1100m Abfahrt. Vespa braucht fast keinen Sprit. Aber: Bremsen werden heiÃŸ!", tag: "fuel" },
      { icon: "â›°ï¸", title: "Lange Abfahrt: Bremsen-Check", text: "1100m HÃ¶henunterschied auf 82 km. Motor-Bremswirkung nutzen (2. Gang). Alle 20 min kurz anhalten und Bremsen abkÃ¼hlen lassen.", tag: "danger" },
      { icon: "ğŸŒ¡ï¸", title: "Temperaturanstieg: +14Â°C", text: "Brenner (1370m): 12Â°C â†’ Bozen (262m): 26Â°C. Die wÃ¤rmste Etappe. Trinkwasser nicht vergessen!", tag: "warn" },
      { icon: "ğŸš§", title: "SS12 vs. SchnellstraÃŸe", text: "Die SS12 (alte StaatsstraÃŸe) ist fÃ¼r Vespa ideal â€“ aber teils eng und Radfahrer-reich. Geduld mitbringen, nicht Ã¼berholen wo's eng ist.", tag: "info" },
    ],
    heightProfile: [
      { label: "BREN", height: 1370, max: 2200 },
      { label: "Sterz", height: 950, max: 2200 },
      { label: "Franz", height: 750, max: 2200 },
      { label: "Brixen", height: 560, max: 2200 },
      { label: "Klaus", height: 520, max: 2200 },
      { label: "Waid", height: 470, max: 2200 },
      { label: "Blum", height: 340, max: 2200 },
      { label: "BOZ", height: 262, max: 2200 },
    ],
    countryInfo: [
      { flag: "ğŸ‡®ğŸ‡¹", name: "IT", maut: "frei (Landstr.)" },
    ],
    mapStops: [
      { name: "Brenner", lng: 11.507, lat: 47.000 },
      { name: "Sterzing", lng: 11.432, lat: 46.893 },
      { name: "Franzensfeste", lng: 11.630, lat: 46.798 },
      { name: "Klausen", lng: 11.562, lat: 46.641 },
      { name: "Bozen", lng: 11.354, lat: 46.498 },
    ]
  },
  4: {
    title: "Bozen â†’ Dolomiten",
    meta: "105 km Â· ~4.5h Â· 4 Stopps",
    countries: "ğŸ‡®ğŸ‡¹",
    budget: { fuel: 14, food: 40, sleep: 60 },
    weather: [
      { time: "07:00", icon: "ğŸŒ¤ï¸", temp: "14Â°" },
      { time: "10:00", icon: "â˜€ï¸", temp: "20Â°" },
      { time: "13:00", icon: "â›…", temp: "15Â°" },
      { time: "16:00", icon: "ğŸŒ¤ï¸", temp: "18Â°" },
    ],
    stops: [
      {
        name: "St. Ulrich / Ortisei (GrÃ¶dnertal)",
        meta: "38 km Â· 09:00 Uhr Â· 45 min",
        desc: "Hauptort des GrÃ¶dnertals â€“ berÃ¼hmt fÃ¼r Holzschnitzerei und als Wintersport-Hotspot. Im Sommer angenehm leer.",
        tips: [
          { type: "tip", tag: "Insider", text: "In den WerkstÃ¤tten der Holzschnitzer kann man zusehen. Uniag (Via Rezia 69) lÃ¤sst Besucher kostenlos in die Werkstatt.", links: ["Google Maps:https://www.google.com/maps/search/Uniag+Holzschnitzerei+St+Ulrich", "Google:https://www.google.com/search?q=Holzschnitzerei+St+Ulrich+GrÃ¶dnertal"] },
          { type: "food", tag: "Einkehr", text: "Anna Stuben: Michelin-Empfehlung, aber entspannte AtmosphÃ¤re. Wildragout mit Polenta â€“ Dolomiten auf dem Teller.", links: ["Google Maps:https://www.google.com/maps/search/Anna+Stuben+St+Ulrich", "Tripadvisor:https://www.tripadvisor.com/Search?q=Anna+Stuben+St+Ulrich+GrÃ¶den"] },
          { type: "photo", tag: "Foto-Spot", text: "Die Gondel-Talstation hat einen freien Blick auf den Langkofel. Morgens gegen 9 Uhr ist das Licht perfekt.", links: ["Google:https://www.google.com/search?q=Langkofel+St+Ulrich+Foto"] },
        ]
      },
      {
        name: "GrÃ¶dner Joch / Passo Gardena (2.121m)",
        meta: "58 km Â· 10:30 Uhr Â· 30 min",
        desc: "Der erste richtige Dolomiten-Pass! Die Vespa kÃ¤mpft sich hoch â€“ aber die Aussicht auf Sellagruppe und Langkofel ist es wert.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Wenn du vor 8:30 Uhr oben bist, hast du den Pass fast fÃ¼r dich allein. Die Reisebusse kommen erst ab 10 Uhr.", links: [] },
          { type: "photo", tag: "Foto-Spot", text: "Am Parkplatz auf der PasshÃ¶he: Vespa mit Sellagruppe im Hintergrund. DAS Dolomiten-Bild.", links: ["Google:https://www.google.com/search?q=GrÃ¶dner+Joch+Panorama+Foto"] },
          { type: "nature", tag: "Natur", text: "5 min zu FuÃŸ vom Parkplatz: Blick in beide TÃ¤ler gleichzeitig. Murmeltiere sind hier morgens aktiv.", links: ["Google:https://www.google.com/search?q=GrÃ¶dner+Joch+Murmeltiere+Wanderung"] },
        ]
      },
      {
        name: "Corvara (Alta Badia)",
        meta: "72 km Â· 12:00 Uhr Â· 60 min Mittagspause",
        desc: "Abfahrt vom GrÃ¶dner Joch ins Gaderthal. Corvara ist das Herz der ladinischen Kultur â€“ hier spricht man die vierte Sprache SÃ¼dtirols.",
        tips: [
          { type: "tip", tag: "Insider", text: "Museum Ladin (5 min zu FuÃŸ): Die ladinische Sprache und Kultur erklÃ¤rt. Ãœberraschend spannend, auch fÃ¼r Nicht-Linguisten.", links: ["Google:https://www.google.com/search?q=Museum+Ladin+Corvara", "Wikipedia:https://de.wikipedia.org/wiki/Ladinische_Sprache"] },
          { type: "food", tag: "Einkehr", text: "Rifugio Scotoni: per Jeep-Shuttle erreichbar oder 40 min Wanderung. KnÃ¶del mit BergkÃ¤se auf 2000m. Reservierung empfohlen.", links: ["Google Maps:https://www.google.com/maps/search/Rifugio+Scotoni+Corvara", "Tripadvisor:https://www.tripadvisor.com/Search?q=Rifugio+Scotoni"] },
          { type: "hidden", tag: "Geheimtipp", text: "Der Klettersteig 'Tridentina' startet hier â€“ fÃ¼r Nicht-Kletterer: der Einstieg allein ist schon ein Erlebnis (10 min, gratis).", links: ["Google:https://www.google.com/search?q=Klettersteig+Tridentina+Corvara"] },
        ]
      },
      {
        name: "Valparola Pass (2.192m)",
        meta: "105 km Â· 15:00 Uhr Â· Ankunft",
        desc: "Der hÃ¶chste Punkt der gesamten Tour! Ein ehemaliger Festungspass aus dem 1. Weltkrieg. Hier endet die Tagesetappe.",
        tips: [
          { type: "photo", tag: "Foto-Spot", text: "Altes Fort auf der PasshÃ¶he â€“ die Vespa vor dem Bunker-Eingang parken. Dramatisch und geschichtstrÃ¤chtig.", links: ["Google:https://www.google.com/search?q=Valparola+Pass+Fort+Foto", "Wikipedia:https://de.wikipedia.org/wiki/Valparolapass"] },
          { type: "tip", tag: "Insider", text: "Im Kriegsmuseum im Fort (â‚¬5) wird der Gebirgskrieg 1915-18 erklÃ¤rt. BerÃ¼hrend und wichtig fÃ¼r den Kontext der Dolomiten.", links: ["Google Maps:https://www.google.com/maps/search/Kriegsmuseum+Valparola+Pass"] },
          { type: "nature", tag: "Natur", text: "Der kleine See direkt unter dem Pass (Lago di Valparola) schimmert tÃ¼rkis. Magischer Ort bei Sonnenuntergang.", links: ["Google:https://www.google.com/search?q=Lago+di+Valparola+See"] },
        ],
        accom: {
          name: "Rifugio Valparola",
          meta: "â˜…â˜… Â· ab â‚¬60/Nacht Â· direkt am Pass Â· Vespa in der Garage",
          tips: "Abends: Sonnenuntergang Ã¼ber den Dolomiten vom Fort aus â€“ zieh alles Warme an, es werden 5Â°C. Morgens: Die Abfahrt Richtung Cortina ist um 7 Uhr ein Traum."
        }
      }
    ],
    hints: [
      { icon: "â›½", title: "KRITISCH: Tankreichweite!", text: "Steigungen fressen Sprit! Bozen bis St. Ulrich VOLL tanken. NÃ¤chste Tankstelle erst Corvara (72 km, davon 2 PÃ¤sse). Im Gebirge sinkt Reichweite auf ~70 km!", tag: "danger" },
      { icon: "â›°ï¸", title: "GrÃ¶dner Joch: 2.121m", text: "Steilste Passage der Tour (~10%). Vespa im 1./2. Gang. NICHT am Rand halten â€“ kein Seitenstreifen. Oben 10 min Pause gÃ¶nnen, Motor abkÃ¼hlen.", tag: "danger" },
      { icon: "ğŸŒ¡ï¸", title: "Extremer Temperaturwechsel", text: "Bozen (262m): 26Â°C â†’ GrÃ¶dner Joch (2121m): 10Â°C â†’ Corvara: 18Â°C â†’ Valparola (2192m): 8Â°C. 4x umziehen an einem Tag!", tag: "warn" },
      { icon: "â›°ï¸", title: "Valparola: 2.192m â€“ hÃ¶chster Punkt", text: "Die letzten 5 km sind steil. Bei Nebel (hÃ¤ufig ab 15 Uhr) Nebelschlussleuchte an. Im Schatten kann es Wasserfilm auf der StraÃŸe geben.", tag: "danger" },
    ],
    heightProfile: [
      { label: "BOZ", height: 262, max: 2200 },
      { label: "Ulrich", height: 1240, max: 2200 },
      { label: "GrÃ¶Jo", height: 2121, max: 2200 },
      { label: "Corv", height: 1568, max: 2200 },
      { label: "Stei", height: 1700, max: 2200 },
      { label: "Prelo", height: 1900, max: 2200 },
      { label: "Fort", height: 2100, max: 2200 },
      { label: "VALP", height: 2192, max: 2200 },
    ],
    countryInfo: [
      { flag: "ğŸ‡®ğŸ‡¹", name: "IT", maut: "frei (PÃ¤sse)" },
    ],
    mapStops: [
      { name: "Bozen", lng: 11.354, lat: 46.498 },
      { name: "St. Ulrich", lng: 11.672, lat: 46.574 },
      { name: "GrÃ¶dner Joch", lng: 11.810, lat: 46.553 },
      { name: "Corvara", lng: 11.874, lat: 46.550 },
      { name: "Valparola", lng: 11.930, lat: 46.528 },
    ]
  },
  5: {
    title: "Dolomiten â†’ Gardasee",
    meta: "90 km Â· ~3.5h Â· 4 Stopps",
    countries: "ğŸ‡®ğŸ‡¹",
    budget: { fuel: 10, food: 38, sleep: 48 },
    weather: [
      { time: "07:00", icon: "ğŸŒ¤ï¸", temp: "8Â°" },
      { time: "10:00", icon: "â˜€ï¸", temp: "22Â°" },
      { time: "13:00", icon: "â˜€ï¸", temp: "28Â°" },
      { time: "16:00", icon: "ğŸŒ¤ï¸", temp: "26Â°" },
    ],
    stops: [
      {
        name: "Cortina d'Ampezzo",
        meta: "25 km Â· 08:30 Uhr Â· 45 min",
        desc: "Die 'KÃ¶nigin der Dolomiten' â€“ glamourÃ¶s, teuer, aber auch ohne Ausgaben wunderschÃ¶n. Olympia-Ort 2026!",
        tips: [
          { type: "tip", tag: "Insider", text: "Im Corso Italia (FuÃŸgÃ¤ngerzone) stehen morgens fast keine Touristen. Die Boutiquen Ã¶ffnen erst um 10 â€“ vorher hat man das Dolomitengebirge als Kulisse fast fÃ¼r sich.", links: ["Google Maps:https://www.google.com/maps/search/Corso+Italia+Cortina", "Wikipedia:https://de.wikipedia.org/wiki/Cortina_d'Ampezzo"] },
          { type: "photo", tag: "Foto-Spot", text: "Vom Kirchturm-Platz: Blick auf die Tofane-Gruppe. Bei klarem Wetter sieht man die Cinque Torri.", links: ["Google:https://www.google.com/search?q=Cortina+Tofane+Panorama+Foto"] },
          { type: "food", tag: "Einkehr", text: "Bar Embassy: Espresso fÃ¼r â‚¬1.20 (yes, auch in Cortina!). Stehbar am Tresen wie ein Einheimischer.", links: ["Google Maps:https://www.google.com/maps/search/Bar+Embassy+Cortina", "Tripadvisor:https://www.tripadvisor.com/Search?q=Bar+Embassy+Cortina"] },
        ]
      },
      {
        name: "Pieve di Cadore",
        meta: "45 km Â· 10:30 Uhr Â· 30 min",
        desc: "Geburtsort von Tizian. Ein ruhiges BergstÃ¤dtchen mit einem Ã¼berraschend guten Museum und tollem Seeblick.",
        tips: [
          { type: "hidden", tag: "Geheimtipp", text: "Casa di Tiziano (Tizians Geburtshaus): â‚¬3 Eintritt, oft komplett leer. Die Nachbarin verkauft handgemachten KÃ¤se.", links: ["Google:https://www.google.com/search?q=Casa+di+Tiziano+Pieve+di+Cadore", "Wikipedia:https://de.wikipedia.org/wiki/Pieve_di_Cadore"] },
          { type: "nature", tag: "Natur", text: "Lago di Centro Cadore â€“ der See schimmert smaragdgrÃ¼n. Kurzer Stopp am Ufer, einfach gucken.", links: ["Google:https://www.google.com/search?q=Lago+Centro+Cadore"] },
          { type: "tip", tag: "Insider", text: "Ab hier beginnt die SS51 Richtung Belluno â€“ eine der schÃ¶nsten Motorradstrecken Italiens. Vespa-tauglich, wenig Verkehr.", links: ["Google:https://www.google.com/search?q=SS51+Belluno+Motorradstrecke"] },
        ]
      },
      {
        name: "Feltre",
        meta: "68 km Â· 12:30 Uhr Â· 60 min Mittagspause",
        desc: "UnterschÃ¤tzte Renaissance-Stadt am FuÃŸ der Berge. Hier wird's warm, mediterran, und die Pizza wird plÃ¶tzlich besser als jede nÃ¶rdlich der Alpen.",
        tips: [
          { type: "tip", tag: "Insider", text: "Piazza Maggiore: einer der schÃ¶nsten Renaissance-PlÃ¤tze Venetiens, fast unbekannt. Donnerstags ist Markt.", links: ["Google:https://www.google.com/search?q=Piazza+Maggiore+Feltre", "Wikipedia:https://de.wikipedia.org/wiki/Feltre"] },
          { type: "food", tag: "Einkehr", text: "Osteria Novecento: MittagsmenÃ¼ (Primo+Secondo+CaffÃ¨) fÃ¼r ~â‚¬14. Authentisch, lokal, keine Touristen.", links: ["Google Maps:https://www.google.com/maps/search/Osteria+Novecento+Feltre", "Tripadvisor:https://www.tripadvisor.com/Search?q=Osteria+Novecento+Feltre"] },
          { type: "hidden", tag: "Geheimtipp", text: "Das Museo Rizzarda hat die beste Jugendstil-Schmiedekunst Norditaliens. â‚¬4, 20 min reichen.", links: ["Google:https://www.google.com/search?q=Museo+Rizzarda+Feltre"] },
        ]
      },
      {
        name: "Riva del Garda",
        meta: "90 km Â· 15:30 Uhr Â· Ankunft",
        desc: "ZIEL! Der Gardasee liegt vor dir. Nach 5 Tagen AlpenÃ¼berquerung hast du dir das erste Gelato verdient.",
        tips: [
          { type: "photo", tag: "Foto-Spot", text: "Von der Bastione (alte Festung, 15 min Aufstieg): DER Blick Ã¼ber den Gardasee. Vespa unten am Hafen parken.", links: ["Google:https://www.google.com/search?q=Bastione+Riva+del+Garda+Aussicht", "Google Maps:https://www.google.com/maps/search/Bastione+Riva+del+Garda"] },
          { type: "hidden", tag: "Geheimtipp", text: "Ponale-StraÃŸe: alte MilitÃ¤rstraÃŸe in die Felswand gebaut. Heute nur FuÃŸgÃ¤nger/Radler â€“ 10 min zu FuÃŸ rein lohnt sich absolut!", links: ["Google:https://www.google.com/search?q=Ponale+StraÃŸe+Riva+del+Garda", "Wikipedia:https://de.wikipedia.org/wiki/Strada_del_Ponale"] },
          { type: "food", tag: "Einkehr", text: "Gelateria Flora: Bestes Eis in Riva. Pistazie und Nocciola. Iss es am Hafen mit Blick auf den See.", links: ["Google Maps:https://www.google.com/maps/search/Gelateria+Flora+Riva+del+Garda", "Tripadvisor:https://www.tripadvisor.com/Search?q=Gelateria+Flora+Riva+del+Garda"] },
        ],
        accom: {
          name: "Hotel Portici",
          meta: "â˜…â˜…â˜… Â· ab â‚¬48/Nacht Â· Altstadt am Hafen Â· Vespa am Piazza",
          tips: "Abends: Aperitivo an der Seepromenade â€“ du hast es geschafft! Morgens: Markt am Mittwoch, Fischstand fÃ¼r frische Sardinen."
        }
      }
    ],
    hints: [
      { icon: "â›½", title: "Letzte Tankstelle: Cortina", text: "Vor Cortina volltanken. Bis Pieve di Cadore gibt's noch eine kleine Tankstelle, aber die SS51 Richtung Feltre hat LÃ¼cken.", tag: "fuel" },
      { icon: "â›°ï¸", title: "Abfahrt: 2.192m â†’ 65m", text: "Ãœber 2.100 HÃ¶henmeter Abstieg heute! Die lÃ¤ngste Abfahrt der Tour. Bremsen-Check: morgens vor Abfahrt kalt prÃ¼fen.", tag: "warn" },
      { icon: "ğŸŒ¡ï¸", title: "Temperatur: von 8Â°C auf 28Â°C", text: "20 Grad Unterschied! Start: alles anziehen. SpÃ¤testens Feltre alles ausziehen. Am Gardasee: Sommer!", tag: "warn" },
      { icon: "ğŸ·ï¸", title: "ZTL-Zonen in Riva!", text: "Riva del Garda hat Fahrverbotszonen (ZTL) im Zentrum. MotorrÃ¤der oft ausgenommen â€“ aber prÃ¼fe die Schilder! Strafe: â‚¬80+.", tag: "danger" },
    ],
    heightProfile: [
      { label: "VALP", height: 2192, max: 2200 },
      { label: "Cort", height: 1224, max: 2200 },
      { label: "Pieve", height: 878, max: 2200 },
      { label: "Long", height: 474, max: 2200 },
      { label: "Feltre", height: 325, max: 2200 },
      { label: "Prim", height: 220, max: 2200 },
      { label: "Arco", height: 91, max: 2200 },
      { label: "RIVA", height: 65, max: 2200 },
    ],
    countryInfo: [
      { flag: "ğŸ‡®ğŸ‡¹", name: "IT", maut: "frei + ZTL!" },
    ],
    mapStops: [
      { name: "Valparola", lng: 11.930, lat: 46.528 },
      { name: "Cortina", lng: 12.136, lat: 46.537 },
      { name: "Pieve", lng: 12.376, lat: 46.428 },
      { name: "Feltre", lng: 11.909, lat: 46.018 },
      { name: "Riva", lng: 10.842, lat: 45.886 },
    ]
  }
};

// â•â•â•â•â•â•â• RENDER FUNCTIONS â•â•â•â•â•â•â•

function renderStops(day) {
  const d = tourData[day];
  let html = '';
  d.stops.forEach((stop, i) => {
    // Bug-Fix: stop.meta aus km/time/duration zusammenbauen falls nicht vorhanden
    const meta = stop.meta || [stop.km, stop.time, stop.duration].filter(Boolean).join(' Â· ') || '';
    html += `<div class="stop-card">
      <div class="stop-title"><span class="stop-num">${i+1}</span>${stop.name}</div>
      <div class="stop-meta">${meta}</div>
      <div class="stop-desc">${stop.desc || ''}</div>
      <div class="tips-list">`;
    (stop.tips || []).forEach(tip => {
      // Bug-Fix: tip.tag aus tip.type ableiten falls nicht vorhanden
      const resolvedTag = tip.tag || tip.type || 'info';
      const tagClass = resolvedTag === 'insider' ? 'tag-tip' : resolvedTag === 'foto-spot' ? 'tag-photo' : resolvedTag === 'einkehr' ? 'tag-food' : resolvedTag === 'kultur' ? 'tag-hidden' : resolvedTag === 'natur' ? 'tag-nature' : resolvedTag === 'warnung' ? 'tag-warn' : 'tag-tip';
      const tipClass = `tip-${tip.type || 'insider'}`;
      let linksHtml = '';
      if (tip.links && tip.links.length > 0) {
        linksHtml = '<div class="tip-links">';
        tip.links.forEach(link => {
          const [label, url] = link.split(':https://');
          const icon = label === 'Google Maps' ? 'ğŸ“' : label === 'Wikipedia' ? 'ğŸ“–' : label === 'Tripadvisor' ? 'â­' : label === 'Booking' ? 'ğŸ¨' : label === 'Google' ? 'ğŸ”' : 'ğŸ”—';
          linksHtml += `<a class="tip-link" href="https://${url}" target="_blank" rel="noopener"><span class="link-icon">${icon}</span>${label}</a>`;
        });
        linksHtml += '</div>';
      }
      const tagLabel = resolvedTag === 'insider' ? 'Insider' : resolvedTag === 'foto-spot' ? 'Foto' : resolvedTag === 'einkehr' ? 'Einkehr' : resolvedTag === 'kultur' ? 'Kultur' : resolvedTag === 'natur' ? 'Natur' : resolvedTag === 'warnung' ? 'Achtung' : 'Tipp';
      html += `<div class="tip ${tipClass}">
        <span class="tip-tag ${tagClass}">${tagLabel}</span>
        <div class="tip-content">
          <div class="tip-text">${tip.text}</div>
          ${linksHtml}
        </div>
      </div>`;
    });
    html += '</div>';
    if (stop.accom) {
      html += `<div class="accom-card">
        <div class="accom-title">ğŸ›ï¸ ${stop.accom.name}</div>
        <div class="accom-meta">${stop.accom.meta}</div>
        <div class="accom-tips">${stop.accom.tips}</div>
      </div>`;
    }
    html += '</div>';
  });
  return html;
}

function renderHints(day) {
  const d = tourData[day];
  let html = '';
  // Bug-Fix: hints null-safe
  (d.hints || []).forEach(hint => {
    // Bug-Fix: hint.tag aus hint.severity ableiten falls nicht vorhanden
    const resolvedTag = hint.tag || (hint.severity === 'warnung' ? 'warn' : hint.severity === 'achtung' ? 'danger' : 'fuel');
    const tagLabel = resolvedTag === 'fuel' ? 'Tanken' : resolvedTag === 'warn' ? 'Achtung' : resolvedTag === 'danger' ? 'Warnung' : 'Info';
    html += `<div class="hint">
      <div class="hint-icon">${hint.icon || 'â„¹ï¸'}</div>
      <div class="hint-content">
        <div class="hint-title">${hint.title || ''}</div>
        <div class="hint-text">${hint.text || ''}</div>
      </div>
      <span class="hint-tag ${resolvedTag}">${tagLabel}</span>
    </div>`;
  });
  // Bug-Fix: HÃ¶henprofil NUR anzeigen wenn echte Daten vorhanden (kein Fake!)
  const heightData = d.heightProfile;
  if (heightData && heightData.length > 0) {
    html += '<div class="height-profile"><div class="height-profile-title">ğŸ“Š HÃ¶henprofil</div><div class="height-bars">';
    heightData.forEach(p => {
      const pct = Math.max(8, (p.height / (p.max || 2000)) * 100);
      const cls = p.height > 1800 ? 'high' : p.height > 1000 ? 'mid' : 'low';
      html += `<div class="height-bar ${cls}" style="height:${pct}%" title="${p.label}: ${p.height}m"></div>`;
    });
    html += '</div><div class="height-labels">';
    heightData.forEach(p => {
      html += `<div class="height-label">${p.label}</div>`;
    });
    html += '</div></div>';
  }
  // Bug-Fix: countryInfo UND countries_detail beide unterstÃ¼tzen
  const countries = d.countryInfo || d.countries_detail || [];
  if (countries.length > 0) {
    html += '<div class="countries-bar">';
    countries.forEach(c => {
      html += `<div class="country-chip"><span class="flag">${c.flag}</span><span>${c.name}</span><span class="maut">${c.maut || ''}</span></div>`;
    });
    html += '</div>';
  }
  return html;
}

function renderMap(day) {
  // No longer returns HTML - handled by initMapbox
}

function renderTotalMap() {
  // No longer returns HTML - handled by initTotalMapbox
}

// â•â•â•â•â•â•â• MAPBOX â•â•â•â•â•â•â•

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  HIER DEINEN MAPBOX TOKEN EINSETZEN (Zeile unten):  â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
mapboxgl.accessToken = 'pk.eyJ1Ijoicm9zY2gtbGFiIiwiYSI6ImNtbHM2Z2tkajAzMmYzY3Nibmx5cHN5ajMifQ.GFMVi5HiIZiGCf7PdmxkYQ';

let dayMap = null;
let totalMap = null;

function initDayMap(day) {
  const d = tourData[day];
  const stops = d.mapStops;
  const container = document.getElementById('mapCanvas');
  container.innerHTML = '';

  // Remove old map instance
  if (dayMap) { dayMap.remove(); dayMap = null; }

  // Calculate bounds to fit all stops
  const bounds = new mapboxgl.LngLatBounds();
  stops.forEach(s => bounds.extend([s.lng, s.lat]));

  dayMap = new mapboxgl.Map({
    container: 'mapCanvas',
    style: 'mapbox://styles/mapbox/outdoors-v12',
    bounds: bounds,
    fitBoundsOptions: { padding: 40 },
    attributionControl: false
  });

  dayMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
  dayMap.addControl(new mapboxgl.AttributionControl({ compact: true }), 'bottom-right');

  dayMap.on('load', () => {
    // Fetch real route from Mapbox Directions API
    // Build waypoints string: lng,lat;lng,lat;...
    const waypoints = stops.map(s => `${s.lng},${s.lat}`).join(';');
    const profile = 'mapbox/driving';
    const exclude = 'motorway'; // Vespa: keine Autobahn!
    const url = `https://api.mapbox.com/directions/v5/${profile}/${waypoints}?geometries=geojson&overview=full&exclude=${exclude}&access_token=${mapboxgl.accessToken}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (data.routes && data.routes[0]) {
          const route = data.routes[0].geometry;

          dayMap.addSource('route', {
            type: 'geojson',
            data: { type: 'Feature', geometry: route }
          });
          // Route shadow
          dayMap.addLayer({
            id: 'route-shadow',
            type: 'line',
            source: 'route',
            paint: {
              'line-color': '#000',
              'line-width': 6,
              'line-opacity': 0.12,
              'line-blur': 4
            }
          });
          // Route line
          dayMap.addLayer({
            id: 'route-line',
            type: 'line',
            source: 'route',
            paint: {
              'line-color': '#c8702a',
              'line-width': 4,
              'line-cap': 'round',
              'line-join': 'round'
            }
          });

          // Fit map to route bounds
          const coords = route.coordinates;
          const routeBounds = new mapboxgl.LngLatBounds();
          coords.forEach(c => routeBounds.extend(c));
          dayMap.fitBounds(routeBounds, { padding: 40 });
        }
      })
      .catch(err => {
        console.warn('Directions API error, falling back to straight line:', err);
        // Fallback: straight line
        const routeCoords = stops.map(s => [s.lng, s.lat]);
        dayMap.addSource('route', {
          type: 'geojson',
          data: { type: 'Feature', geometry: { type: 'LineString', coordinates: routeCoords } }
        });
        dayMap.addLayer({
          id: 'route-line', type: 'line', source: 'route',
          paint: { 'line-color': '#c8702a', 'line-width': 3, 'line-dasharray': [2, 1] }
        });
      });

    // Stop markers
    stops.forEach((s, i) => {
      const isFirst = i === 0;
      const isLast = i === stops.length - 1;
      const color = isFirst ? '#3d6b4f' : isLast ? '#c45c4a' : '#2c3e2d';
      const size = isFirst || isLast ? 14 : 10;

      const el = document.createElement('div');
      el.style.cssText = `
        width: ${size}px; height: ${size}px;
        background: ${color}; border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        cursor: pointer;
      `;

      const popup = new mapboxgl.Popup({ offset: 12, closeButton: false })
        .setHTML(`<div style="font-family:DM Sans,sans-serif;font-size:12px;">
          <strong>${s.name}</strong><br>
          <span style="color:#6b6b6b;">Stopp ${i+1} von ${stops.length}</span>
        </div>`);

      new mapboxgl.Marker({ element: el })
        .setLngLat([s.lng, s.lat])
        .setPopup(popup)
        .addTo(dayMap);
    });
  });
}

function initTotalMap() {
  const container = document.getElementById('totalMapCanvas');
  container.innerHTML = '';

  if (totalMap) { totalMap.remove(); totalMap = null; }

  const colors = ['#c8702a', '#3d6b4f', '#5b8ab5', '#7b5a9e', '#c45c4a'];
  const allStops = [
    { name: "MÃ¼nchen", lng: 11.576, lat: 48.137 },
    { name: "Kochel", lng: 11.369, lat: 47.659 },
    { name: "Mittenwald", lng: 11.264, lat: 47.442 },
    { name: "Innsbruck", lng: 11.394, lat: 47.269 },
    { name: "Brenner", lng: 11.507, lat: 47.000 },
    { name: "Sterzing", lng: 11.432, lat: 46.893 },
    { name: "Bozen", lng: 11.354, lat: 46.498 },
    { name: "St. Ulrich", lng: 11.672, lat: 46.574 },
    { name: "GrÃ¶dner Joch", lng: 11.810, lat: 46.553 },
    { name: "Valparola", lng: 11.930, lat: 46.528 },
    { name: "Cortina", lng: 12.136, lat: 46.537 },
    { name: "Feltre", lng: 11.909, lat: 46.018 },
    { name: "Riva", lng: 10.842, lat: 45.886 },
  ];
  const daySegments = [
    [0,1,2,3], [3,4], [4,5,6], [6,7,8,9], [9,10,11,12]
  ];

  const bounds = new mapboxgl.LngLatBounds();
  allStops.forEach(s => bounds.extend([s.lng, s.lat]));

  totalMap = new mapboxgl.Map({
    container: 'totalMapCanvas',
    style: 'mapbox://styles/mapbox/outdoors-v12',
    bounds: bounds,
    fitBoundsOptions: { padding: 30 },
    attributionControl: false
  });

  totalMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
  totalMap.addControl(new mapboxgl.AttributionControl({ compact: true }), 'bottom-right');

  totalMap.on('load', () => {
    // Fetch real routes for each day segment
    const exclude = 'motorway';
    daySegments.forEach((seg, di) => {
      const waypoints = seg.map(idx => `${allStops[idx].lng},${allStops[idx].lat}`).join(';');
      const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${waypoints}?geometries=geojson&overview=full&exclude=${exclude}&access_token=${mapboxgl.accessToken}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.routes && data.routes[0]) {
            totalMap.addSource(`route-${di}`, {
              type: 'geojson',
              data: { type: 'Feature', geometry: data.routes[0].geometry }
            });
            totalMap.addLayer({
              id: `route-shadow-${di}`,
              type: 'line',
              source: `route-${di}`,
              paint: { 'line-color': '#000', 'line-width': 5, 'line-opacity': 0.08, 'line-blur': 3 }
            });
            totalMap.addLayer({
              id: `route-${di}`,
              type: 'line',
              source: `route-${di}`,
              paint: {
                'line-color': colors[di],
                'line-width': 3.5,
                'line-cap': 'round',
                'line-join': 'round',
                'line-opacity': 0.85
              }
            });
          }
        })
        .catch(err => {
          // Fallback: straight line
          const coords = seg.map(idx => [allStops[idx].lng, allStops[idx].lat]);
          totalMap.addSource(`route-${di}`, {
            type: 'geojson',
            data: { type: 'Feature', geometry: { type: 'LineString', coordinates: coords } }
          });
          totalMap.addLayer({
            id: `route-${di}`, type: 'line', source: `route-${di}`,
            paint: { 'line-color': colors[di], 'line-width': 3, 'line-dasharray': [2, 1] }
          });
        });
    });

    // Stop markers
    allStops.forEach((s, i) => {
      const isEndpoint = i === 0 || i === allStops.length - 1;
      const size = isEndpoint ? 12 : 8;
      const color = isEndpoint ? '#c45c4a' : '#2c3e2d';

      const el = document.createElement('div');
      el.style.cssText = `
        width: ${size}px; height: ${size}px;
        background: ${color}; border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        cursor: pointer;
      `;

      const popup = new mapboxgl.Popup({ offset: 10, closeButton: false })
        .setHTML(`<div style="font-family:DM Sans,sans-serif;font-size:12px;">
          <strong>${s.name}</strong>
        </div>`);

      new mapboxgl.Marker({ element: el })
        .setLngLat([s.lng, s.lat])
        .setPopup(popup)
        .addTo(totalMap);
    });
  });
}

// â•â•â•â•â•â•â• NAVIGATION â•â•â•â•â•â•â•

let currentDay = 1;

function switchDay(day) {
  // Update pills
  document.querySelectorAll('.day-pill').forEach(p => p.classList.remove('active'));
  document.querySelector(`.day-pill[data-day="${day}"]`).classList.add('active');

  if (day === 'total') {
    document.getElementById('tilesView').style.display = 'none';
    document.getElementById('totalView').classList.add('active');
    setTimeout(() => initTotalMap(), 50);
    return;
  }

  document.getElementById('tilesView').style.display = 'flex';
  document.getElementById('totalView').classList.remove('active');
  currentDay = day;
  const d = tourData[day];

  // Update Tile A
  document.getElementById('tileATitle').textContent = d.title;
  document.getElementById('tileAMeta').textContent = d.meta;
  document.getElementById('tileABody').innerHTML = renderStops(day);

  // Budget
  document.getElementById('budgetFuel').textContent = `â‚¬${d.budget.fuel}`;
  document.getElementById('budgetFood').textContent = `â‚¬${d.budget.food}`;
  document.getElementById('budgetSleep').textContent = `â‚¬${d.budget.sleep}`;
  document.getElementById('budgetTotal').textContent = `Î£ â‚¬${d.budget.fuel + d.budget.food + d.budget.sleep}`;

  // Tile B: Mapbox
  document.getElementById('tileBCountry').textContent = d.countries;
  setTimeout(() => initDayMap(day), 50);

  // Tile C: Hints
  document.getElementById('tileCBody').innerHTML = renderHints(day);
}

// Initial render
switchDay(1);

// â•â•â•â•â•â•â• MODAL & TOUR GENERATION â•â•â•â•â•â•â•

let selectedVehicle = 'vespa';

function toggleView(view) {
  if (view === 'form') {
    document.getElementById('tourModal').classList.add('active');
  }
}

function closeTourModal() {
  document.getElementById('tourModal').classList.remove('active');
}

function selectVehicle(el, vehicle) {
  document.querySelectorAll('.vehicle-option').forEach(v => v.classList.remove('selected'));
  el.classList.add('selected');
  selectedVehicle = vehicle;
}

async function generateTour() {
  const start = document.getElementById('tourStart').value.trim();
  const end = document.getElementById('tourEnd').value.trim();
  const days = document.getElementById('tourDays').value;
  const vibe = document.getElementById('tourVibe').value;
  const notes = document.getElementById('tourNotes').value.trim();

  if (!start || !end) {
    alert('Bitte Start und Ziel eingeben!');
    return;
  }

  // Close modal, show loading
  closeTourModal();
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('active');

  const statusEl = document.getElementById('loadingStatus');
  const messages = [
    'Claude analysiert die Route...',
    'Insider-Tipps werden recherchiert...',
    'Streckenhinweise werden geprÃ¼ft...',
    'GPS-Koordinaten werden berechnet...',
    'Budget wird kalkuliert...',
    'Packliste wird zusammengestellt...',
    'Fast fertig â€“ Tour wird aufbereitet...'
  ];
  let msgIdx = 0;
  const msgInterval = setInterval(() => {
    msgIdx = (msgIdx + 1) % messages.length;
    statusEl.textContent = messages[msgIdx];
  }, 3000);

  try {
    const vibeWithNotes = notes ? `${vibe}. ZusatzwÃ¼nsche: ${notes}` : vibe;

    const response = await fetch('/api/plan-tour', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        start, end,
        vehicle: selectedVehicle,
        days: parseInt(days),
        vibe: vibeWithNotes
      })
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.error || 'API Fehler');
    }

    const data = await response.json();
    clearInterval(msgInterval);
    applyGeneratedTour(data);

  } catch (error) {
    clearInterval(msgInterval);
    overlay.classList.remove('active');
    alert('Fehler bei der Tour-Generierung: ' + error.message);
  }
}

function applyGeneratedTour(data) {
  // Replace tourData with generated data
  const dayKeys = Object.keys(data.days).map(Number).sort();

  // Clear and rebuild tourData
  for (const key in tourData) delete tourData[key];
  dayKeys.forEach(dayNum => {
    const d = data.days[dayNum];
    tourData[dayNum] = d;
  });

  // Update vehicle badge
  const vehicleNames = {
    vespa: 'ğŸ›µ Vespa 125cc Â· max 90 km/h Â· keine Autobahn',
    wohnmobil: 'ğŸš Wohnmobil 7.20m Â· 4.8t Â· max 100 km/h',
    auto: 'ğŸš— Auto Â· alle StraÃŸen Â· flexibel',
    fahrrad: 'ğŸš² Fahrrad/E-Bike Â· Radwege Â· max 80km/Tag'
  };
  document.querySelector('.vehicle-badge').textContent = vehicleNames[selectedVehicle] || vehicleNames.vespa;

  // Rebuild day pills
  const dayNav = document.getElementById('dayNav');
  dayNav.innerHTML = '';
  dayKeys.forEach((dayNum, i) => {
    const pill = document.createElement('div');
    pill.className = 'day-pill' + (i === 0 ? ' active' : '');
    pill.dataset.day = dayNum;
    pill.onclick = () => switchDay(dayNum);
    pill.textContent = `Tag ${dayNum} Â· ${tourData[dayNum].title}`;
    dayNav.appendChild(pill);
  });
  // Total pill
  const totalPill = document.createElement('div');
  totalPill.className = 'day-pill total';
  totalPill.dataset.day = 'total';
  totalPill.onclick = () => switchDay('total');
  totalPill.textContent = 'ğŸ“Š Total';
  dayNav.appendChild(totalPill);

  // Update total view stats
  const totalKm = data.totalKm || dayKeys.reduce((sum, d) => {
    const meta = tourData[d].meta || '';
    const m = meta.match(/(\d+)\s*km/);
    return sum + (m ? parseInt(m[1]) : 0);
  }, 0);
  const totalBudget = data.totalBudget || dayKeys.reduce((sum, d) => {
    const b = tourData[d].budget;
    return sum + (b ? b.fuel + b.food + b.sleep : 0);
  }, 0);
  const totalStops = dayKeys.reduce((sum, d) => sum + (tourData[d].stops ? tourData[d].stops.length : 0), 0);

  // Update total view if elements exist
  const statValues = document.querySelectorAll('.stat-value');
  if (statValues.length >= 4) {
    statValues[0].textContent = totalKm;
    statValues[1].textContent = dayKeys.length;
    statValues[2].textContent = 'â‚¬' + totalBudget;
    statValues[3].textContent = totalStops;
  }

  // Update highlights
  if (data.highlights) {
    const highlightsContainer = document.querySelector('.total-view .tile-body');
    // Will be handled by switchDay('total')
  }

  // Hide loading, show first day
  document.getElementById('loadingOverlay').classList.remove('active');
  switchDay(dayKeys[0]);
}

// â•â•â•â•â•â•â• DRAG RESIZE â•â•â•â•â•â•â•
// Generic drag handler for resizable panels

function initDragResize(handleId, beforeId, afterId, direction) {
  const handle = document.getElementById(handleId);
  const before = document.getElementById(beforeId);
  const after = document.getElementById(afterId);
  if (!handle || !before || !after) return;

  let startPos, startBeforeSize, startAfterSize, totalSize;

  handle.addEventListener('mousedown', (e) => {
    e.preventDefault();
    handle.classList.add('active');
    document.body.style.cursor = direction === 'h' ? 'col-resize' : 'row-resize';
    document.body.style.userSelect = 'none';

    if (direction === 'h') {
      startPos = e.clientX;
      startBeforeSize = before.getBoundingClientRect().width;
      startAfterSize = after.getBoundingClientRect().width;
    } else {
      startPos = e.clientY;
      startBeforeSize = before.getBoundingClientRect().height;
      startAfterSize = after.getBoundingClientRect().height;
    }
    totalSize = startBeforeSize + startAfterSize;

    function onMove(e) {
      const delta = direction === 'h' ? e.clientX - startPos : e.clientY - startPos;
      const newBefore = Math.max(120, Math.min(totalSize - 120, startBeforeSize + delta));
      const newAfter = totalSize - newBefore;

      before.style.flex = 'none';
      after.style.flex = 'none';
      if (direction === 'h') {
        before.style.width = newBefore + 'px';
        after.style.width = newAfter + 'px';
      } else {
        before.style.height = newBefore + 'px';
        after.style.height = newAfter + 'px';
      }

      // Resize Mapbox maps if visible
      if (dayMap) dayMap.resize();
      if (totalMap) totalMap.resize();
    }

    function onUp() {
      handle.classList.remove('active');
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
    }

    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });
}

// Day view: left/right split + map/hints split
initDragResize('dragH1', 'tilesLeft', 'tilesRight', 'h');
initDragResize('dragV1', 'tileB', 'tileC', 'v');

// Total view: left/right split + map/tips split
initDragResize('dragH2', 'totalLeft', 'totalRight', 'h');
// For total right map/tips, we need the tile IDs
(function() {
  const rightTiles = document.querySelectorAll('#totalRight > .tile');
  if (rightTiles.length >= 2) {
    rightTiles[0].id = 'totalMapTile';
    rightTiles[1].id = 'totalTipsTile';
    initDragResize('dragV2', 'totalMapTile', 'totalTipsTile', 'v');
  }
})();
</script>
</body>
</html>
